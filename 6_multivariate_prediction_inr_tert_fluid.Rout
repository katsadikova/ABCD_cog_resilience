
R version 4.2.1 (2022-06-23) -- "Funny-Looking Kid"
Copyright (C) 2022 The R Foundation for Statistical Computing
Platform: x86_64-apple-darwin17.0 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

[Previously saved workspace restored]

> #----------------------------------------------------------------------------#
> #--- 6_multivariate_prediction.R
> #--- Date: 10/5/2023
> #----------------------------------------------------------------------------#
> 
> library(tidyverse)
── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
✔ ggplot2 3.4.4     ✔ purrr   1.0.2
✔ tibble  3.2.1     ✔ dplyr   1.1.4
✔ tidyr   1.3.0     ✔ stringr 1.5.1
✔ readr   2.1.3     ✔ forcats 0.5.2
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
> library(kableExtra)

Attaching package: ‘kableExtra’

The following object is masked from ‘package:dplyr’:

    group_rows

> library(gtsummary)
> library(expss)
Loading required package: maditr

To get total summary skip 'by' argument: take_all(mtcars, mean)


Attaching package: ‘maditr’

The following objects are masked from ‘package:dplyr’:

    between, coalesce, first, last

The following object is masked from ‘package:purrr’:

    transpose

The following object is masked from ‘package:readr’:

    cols


Use 'expss_output_rnotebook()' to display tables inside R Notebooks.
 To return to the console output, use 'expss_output_default()'.


Attaching package: ‘expss’

The following objects are masked from ‘package:gtsummary’:

    contains, vars

The following objects are masked from ‘package:stringr’:

    fixed, regex

The following objects are masked from ‘package:dplyr’:

    compute, contains, na_if, recode, vars, where

The following objects are masked from ‘package:purrr’:

    keep, modify, modify_if, when

The following objects are masked from ‘package:tidyr’:

    contains, nest

The following object is masked from ‘package:ggplot2’:

    vars

> library(haven)

Attaching package: ‘haven’

The following objects are masked from ‘package:expss’:

    is.labelled, read_spss

> library(sjlabelled)

Attaching package: ‘sjlabelled’

The following objects are masked from ‘package:haven’:

    as_factor, read_sas, read_spss, read_stata, write_sas, zap_labels

The following object is masked from ‘package:expss’:

    read_spss

The following object is masked from ‘package:forcats’:

    as_factor

The following object is masked from ‘package:dplyr’:

    as_label

The following object is masked from ‘package:ggplot2’:

    as_label

> library(readxl)
> library(gtools)
> library(tableone)
> library(mice)

Attaching package: ‘mice’

The following object is masked from ‘package:stats’:

    filter

The following objects are masked from ‘package:base’:

    cbind, rbind

> library(HIMA)
Loading required package: ncvreg
Loading required package: glmnet
Loading required package: Matrix

Attaching package: ‘Matrix’

The following objects are masked from ‘package:tidyr’:

    expand, pack, unpack

Loaded glmnet 4.1-4

Attaching package: ‘glmnet’

The following object is masked from ‘package:gtools’:

    na.replace

*************************************************************************************
HIMA version 2.0.1
To access full functionality of HIMA, please make sure this version is current.

Citation:
  1. Zhang H, Zheng Y, Zhang Z, Gao T, Joyce B, Yoon G, Zhang W, Schwartz J,
     Just A, Colicino E, Vokonas P, Zhao L, Lv J, Baccarelli A, Hou L, Liu L.
     Estimating and Testing High-dimensional Mediation Effects in Epigenetic Studies.
     Bioinformatics. 2016;32(20):3150-4.
     PMID: 27357171; PMCID: PMC5048064.

  2. Zhang H, Zheng Y, Hou L, Zheng C, Liu L.
     Mediation Analysis for Survival Data with High-Dimensional Mediators.
     Bioinformatics. 2021;37(21):3815-21.
     PMID: 34343267. PMCID: PMC8570823.

  3. Zhang H, Chen J, Feng Y, Wang C, Li H, Liu L. 
     Mediation effect selection in high-dimensional and compositional microbiome data.
     Stat Med. 2021;40(4):885-96.
     PMID: 33205470. PMCID: PMC7855955.

*************************************************************************************
> library(corrplot)
corrplot 0.92 loaded
> library(reshape2)

Attaching package: ‘reshape2’

The following objects are masked from ‘package:maditr’:

    dcast, melt

The following object is masked from ‘package:tidyr’:

    smiths

> library(mclust)
Package 'mclust' version 6.0.0
Type 'citation("mclust")' for citing this R package in publications.

Attaching package: ‘mclust’

The following object is masked from ‘package:purrr’:

    map

> library(mlogit)
Loading required package: dfidx

Attaching package: ‘dfidx’

The following object is masked from ‘package:stats’:

    filter

> library(tidyLPA)
You can use the function citation('tidyLPA') to create a citation for the use of {tidyLPA}.
Mplus is not installed. Use only package = 'mclust' when calling estimate_profiles().
> library(SuperLearner)
Loading required package: nnls
Loading required package: gam
Loading required package: splines
Loading required package: foreach

Attaching package: ‘foreach’

The following object is masked from ‘package:expss’:

    when

The following objects are masked from ‘package:purrr’:

    accumulate, when

Loaded gam 1.20.2

Super Learner
Version: 2.0-28
Package created on 2021-05-04

> library(xgboost)

Attaching package: ‘xgboost’

The following object is masked from ‘package:dfidx’:

    slice

The following object is masked from ‘package:dplyr’:

    slice

> library(finalfit)

Attaching package: ‘finalfit’

The following object is masked from ‘package:sjlabelled’:

    remove_labels

> library(caret)
Loading required package: lattice

Attaching package: ‘caret’

The following object is masked from ‘package:purrr’:

    lift

> library(pROC) 
Type 'citation("pROC")' for a citation.

Attaching package: ‘pROC’

The following objects are masked from ‘package:stats’:

    cov, smooth, var

> 
> 
> 
> 
> #-- Non-missing INR - retain 10313 out of 11868 obs
> load("/Users/Kat/Library/CloudStorage/OneDrive-HarvardUniversity/abcd_study_with_kat/temp_dat/dat_all_inr.Rda")
> 
> #-- Complete cases on all considered predictors - only 5439 out of 11868
> load("/Users/Kat/Library/CloudStorage/OneDrive-HarvardUniversity/abcd_study_with_kat/temp_dat/dat_all_inr_complete.Rda")
> 
> #-- 1x imputed data for 10313 out of 11868 with non-missing INR
> load("/Users/Kat/Library/CloudStorage/OneDrive-HarvardUniversity/abcd_study_with_kat/temp_dat/d_imp_updated.Rdata")
> 
> #-- Load in data dictionary - to be able to label variables
> dict <- read.csv("/Users/Kat/Library/CloudStorage/OneDrive-HarvardUniversity/abcd_study_with_kat/temp_dat/data_dict.csv")
> 
> names(dat_all_inr)
  [1] "src_subject_id"                 "inr"                           
  [3] "nihtbx_fluidcomp_agecorrected"  "nihtbx_cryst_agecorrected"     
  [5] "nihtbx_totalcomp_agecorrected"  "fluid_s"                       
  [7] "cryst_s"                        "totcomp_s"                     
  [9] "inr_quart"                      "inr_tert"                      
 [11] "pov_highflcog"                  "pov_lowflcog"                  
 [13] "welloff_highflcog"              "welloff_lowflcog"              
 [15] "pov_highcrcog"                  "pov_lowcrcog"                  
 [17] "welloff_highcrcog"              "welloff_lowcrcog"              
 [19] "pov3_highflcog"                 "pov3_lowflcog"                 
 [21] "welloff3_highflcog"             "welloff3_lowflcog"             
 [23] "pov3_highcrcog"                 "pov3_lowcrcog"                 
 [25] "welloff3_highcrcog"             "welloff3_lowcrcog"             
 [27] "rel_family_id"                  "interview_age"                 
 [29] "srpf_y_ss_ses"                  "nsc_p_ss_mean_3_items"         
 [31] "fes_p_ss_fc"                    "fes_y_ss_fc"                   
 [33] "crpbi_y_ss_parent"              "crpbi_y_ss_caregiver"          
 [35] "pmq_y_ss_mean"                  "psb_p_ss_mean"                 
 [37] "psb_y_ss_mean"                  "reshist_addr1_coi_ed_attain"   
 [39] "reshist_addr1_coi_ed_apenr"     "reshist_addr1_coi_ed_college"  
 [41] "reshist_addr1_coi_ed_prxece"    "reshist_addr1_coi_ed_ecenrol"  
 [43] "reshist_addr1_coi_ed_hsgrad"    "reshist_addr1_coi_ed_prxhqece" 
 [45] "reshist_addr1_coi_ed_schpov"    "reshist_addr1_coi_ed_teachxp"  
 [47] "reshist_addr1_coi_ed_math"      "reshist_addr1_coi_ed_reading"  
 [49] "reshist_addr1_coi_he_green"     "reshist_addr1_coi_he_food"     
 [51] "reshist_addr1_coi_he_pm25"      "reshist_addr1_coi_he_heat"     
 [53] "reshist_addr1_coi_he_suprfnd"   "reshist_addr1_coi_he_hlthins"  
 [55] "reshist_addr1_coi_he_vacancy"   "reshist_addr1_coi_he_rsei"     
 [57] "reshist_addr1_coi_he_ozone"     "reshist_addr1_coi_he_walk"     
 [59] "reshist_addr1_coi_se_jobprox"   "reshist_addr1_coi_se_emprat"   
 [61] "reshist_addr1_coi_se_occ"       "reshist_addr1_coi_se_home"     
 [63] "reshist_addr1_coi_se_mhe"       "reshist_addr1_coi_se_povrate"  
 [65] "reshist_addr1_coi_se_public"    "reshist_addr1_coi_se_single"   
 [67] "reshist_addr1_adi_perc"         "reshist_addr1_popdensity"      
 [69] "reshist_addr1_urban_area"       "reshist_addr1_walkindex"       
 [71] "reshist_addr1_traffic_count"    "reshist_addr1_proxrd"          
 [73] "reshist_addr1_svi_tot_20142018" "reshist_addr1_p1vlnt"          
 [75] "reshist_addr1_leadrisk"         "reshist_addr1_urbsat_ntl"      
 [77] "reshist_addr1_seg_diss_nww_m"   "reshist_addr1_seg_inter_nww_m" 
 [79] "reshist_addr1_seg_ice_income"   "reshist_addr1_seg_ice_inc_bw"  
 [81] "reshist_addr1_seg_entropy_t"    "reshist_state_racism_factor"   
 [83] "reshist_state_so_factor"        "reshist_state_sexism_factor"   
 [85] "reshist_addr1_ACAexpand"        "demo_mar_livingwith"           
 [87] "demo_prnt_ed_v2"                "demo_prtnr_ed_v2"              
 [89] "demo_fam_exp1_v2"               "demo_fam_exp2_v2"              
 [91] "demo_fam_exp3_v2"               "demo_fam_exp4_v2"              
 [93] "demo_fam_exp5_v2"               "demo_fam_exp6_v2"              
 [95] "demo_fam_exp7_v2"               "ksads_ptsd_raw_754_p"          
 [97] "ksads_ptsd_raw_755_p"           "ksads_ptsd_raw_756_p"          
 [99] "ksads_ptsd_raw_757_p"           "ksads_ptsd_raw_758_p"          
[101] "ksads_ptsd_raw_759_p"           "ksads_ptsd_raw_760_p"          
[103] "ksads_ptsd_raw_761_p"           "ksads_ptsd_raw_762_p"          
[105] "ksads_ptsd_raw_763_p"           "ksads_ptsd_raw_764_p"          
[107] "ksads_ptsd_raw_765_p"           "ksads_ptsd_raw_766_p"          
[109] "ksads_ptsd_raw_767_p"           "ksads_ptsd_raw_768_p"          
[111] "ksads_ptsd_raw_769_p"           "ksads_ptsd_raw_770_p"          
[113] "ksads_ptsd_accident"            "ksads_ptsd_wit_viol"           
[115] "ksads_ptsd_thr_viol"            "ksads_ptsd_phys_abuse"         
[117] "ksads_ptsd_sexual_abuse"        "kbi_p_c_bully"                 
[119] "famhx_ss_fath_prob_alc_p"       "famhx_ss_moth_prob_alc_p"      
[121] "famhx_ss_moth_prob_dg_p"        "famhx_ss_fath_prob_dg_p"       
[123] "famhx_ss_fath_prob_prf_p"       "famhx_ss_moth_prob_prf_p"      
[125] "famhx_ss_moth_prob_hspd_p"      "famhx_ss_fath_prob_hspd_p"     
[127] "asr_q06_p"                      "asr_q90_p"                     
[129] "asr_q126_p"                     "asr_scr_anxdep_t"              
[131] "asr_scr_withdrawn_t"            "asr_scr_somatic_t"             
[133] "asr_scr_thought_t"              "asr_scr_attention_t"           
[135] "asr_scr_aggressive_t"           "asr_scr_rulebreak_t"           
[137] "asr_scr_intrusive_t"            "pubertal_sex_p"                
[139] "pds_p_ss_cat"                   "birth_weight"                  
[141] "devhx_3_p"                      "devhx_4_p"                     
[143] "devhx_6_p"                      "preg_any_subst"                
[145] "devhx_10"                       "preg_caffeine"                 
[147] "birth_complications"            "devhx_13_3_p"                  
[149] "devhx_18_p"                     "physical_activity1_y"          
[151] "physical_activity5_y"           "sai_p_activities___24"         
[153] "sai_p_perf_arts"                "sai_p_team_sports"             
[155] "sai_p_non_team_sports"          "sai_p_other"                   
[157] "sai_p_any"                      "sds_p_ss_dims"                 
[159] "sds_p_ss_sbd"                   "sds_p_ss_da"                   
[161] "sds_p_ss_swtd"                  "sds_p_ss_does"                 
[163] "sds_p_ss_shy"                   "sds_p_ss_total"                
[165] "screentime1_p_hours"            "screentime2_p_hours"           
[167] "bis_y_ss_bas_drive"             "bis_y_ss_bas_fs"               
[169] "bis_y_ss_bas_rr"                "bis_y_ss_bis_sum"              
[171] "upps_y_ss_positive_urgency"     "upps_y_ss_negative_urgency"    
[173] "upps_y_ss_lack_of_planning"     "upps_y_ss_lack_of_perseverance"
[175] "upps_y_ss_sensation_seeking"    "cbcl_scr_syn_anxdep_r"         
[177] "cbcl_scr_syn_withdep_r"         "cbcl_scr_syn_somatic_r"        
[179] "cbcl_scr_syn_social_r"          "cbcl_scr_syn_thought_r"        
[181] "cbcl_scr_syn_attention_r"       "cbcl_scr_syn_rulebreak_r"      
[183] "cbcl_scr_syn_aggressive_r"      "num_friends"                   
[185] "num_close_friends"              "parent_su_comm_risk"           
[187] "parent_subst_rules"             "parent_no_subst_rules"         
[189] "peer_deviance"                  "some_peer_deviance"            
> vars <- names(dat_all_inr)[c(2,28:190)]
> 
> 
> #--------------------------------------------------------------------#
> #-- XGBoost alone - can handle missing data in predictor variables --#
> 
> #---------------------------------------------------#
> #-- Poverty (tertiles), fluid cognitive function --#
> 
> d_pov_highcog <- dat_all_inr %>% filter(pov3_highflcog==1) %>% 
+   mutate(profile="pov3_highflcog",
+          resilience=1)
> d_pov_lowcog <- dat_all_inr %>% filter(pov3_lowflcog==1) %>% 
+   mutate(profile="pov3_lowflcog",
+          resilience=0)
> 
> d_flpov <- rbind(d_pov_highcog,d_pov_lowcog)
> 
> 
> #-------------------------------------------------------------------------------#
> #-- 10-fold cross-validated XGBoost in data with missing values in predictors --#
> 
> set.seed(123)
> labels <- d_flpov$resilience
> 
> names(d_flpov)
  [1] "src_subject_id"                 "inr"                           
  [3] "nihtbx_fluidcomp_agecorrected"  "nihtbx_cryst_agecorrected"     
  [5] "nihtbx_totalcomp_agecorrected"  "fluid_s"                       
  [7] "cryst_s"                        "totcomp_s"                     
  [9] "inr_quart"                      "inr_tert"                      
 [11] "pov_highflcog"                  "pov_lowflcog"                  
 [13] "welloff_highflcog"              "welloff_lowflcog"              
 [15] "pov_highcrcog"                  "pov_lowcrcog"                  
 [17] "welloff_highcrcog"              "welloff_lowcrcog"              
 [19] "pov3_highflcog"                 "pov3_lowflcog"                 
 [21] "welloff3_highflcog"             "welloff3_lowflcog"             
 [23] "pov3_highcrcog"                 "pov3_lowcrcog"                 
 [25] "welloff3_highcrcog"             "welloff3_lowcrcog"             
 [27] "rel_family_id"                  "interview_age"                 
 [29] "srpf_y_ss_ses"                  "nsc_p_ss_mean_3_items"         
 [31] "fes_p_ss_fc"                    "fes_y_ss_fc"                   
 [33] "crpbi_y_ss_parent"              "crpbi_y_ss_caregiver"          
 [35] "pmq_y_ss_mean"                  "psb_p_ss_mean"                 
 [37] "psb_y_ss_mean"                  "reshist_addr1_coi_ed_attain"   
 [39] "reshist_addr1_coi_ed_apenr"     "reshist_addr1_coi_ed_college"  
 [41] "reshist_addr1_coi_ed_prxece"    "reshist_addr1_coi_ed_ecenrol"  
 [43] "reshist_addr1_coi_ed_hsgrad"    "reshist_addr1_coi_ed_prxhqece" 
 [45] "reshist_addr1_coi_ed_schpov"    "reshist_addr1_coi_ed_teachxp"  
 [47] "reshist_addr1_coi_ed_math"      "reshist_addr1_coi_ed_reading"  
 [49] "reshist_addr1_coi_he_green"     "reshist_addr1_coi_he_food"     
 [51] "reshist_addr1_coi_he_pm25"      "reshist_addr1_coi_he_heat"     
 [53] "reshist_addr1_coi_he_suprfnd"   "reshist_addr1_coi_he_hlthins"  
 [55] "reshist_addr1_coi_he_vacancy"   "reshist_addr1_coi_he_rsei"     
 [57] "reshist_addr1_coi_he_ozone"     "reshist_addr1_coi_he_walk"     
 [59] "reshist_addr1_coi_se_jobprox"   "reshist_addr1_coi_se_emprat"   
 [61] "reshist_addr1_coi_se_occ"       "reshist_addr1_coi_se_home"     
 [63] "reshist_addr1_coi_se_mhe"       "reshist_addr1_coi_se_povrate"  
 [65] "reshist_addr1_coi_se_public"    "reshist_addr1_coi_se_single"   
 [67] "reshist_addr1_adi_perc"         "reshist_addr1_popdensity"      
 [69] "reshist_addr1_urban_area"       "reshist_addr1_walkindex"       
 [71] "reshist_addr1_traffic_count"    "reshist_addr1_proxrd"          
 [73] "reshist_addr1_svi_tot_20142018" "reshist_addr1_p1vlnt"          
 [75] "reshist_addr1_leadrisk"         "reshist_addr1_urbsat_ntl"      
 [77] "reshist_addr1_seg_diss_nww_m"   "reshist_addr1_seg_inter_nww_m" 
 [79] "reshist_addr1_seg_ice_income"   "reshist_addr1_seg_ice_inc_bw"  
 [81] "reshist_addr1_seg_entropy_t"    "reshist_state_racism_factor"   
 [83] "reshist_state_so_factor"        "reshist_state_sexism_factor"   
 [85] "reshist_addr1_ACAexpand"        "demo_mar_livingwith"           
 [87] "demo_prnt_ed_v2"                "demo_prtnr_ed_v2"              
 [89] "demo_fam_exp1_v2"               "demo_fam_exp2_v2"              
 [91] "demo_fam_exp3_v2"               "demo_fam_exp4_v2"              
 [93] "demo_fam_exp5_v2"               "demo_fam_exp6_v2"              
 [95] "demo_fam_exp7_v2"               "ksads_ptsd_raw_754_p"          
 [97] "ksads_ptsd_raw_755_p"           "ksads_ptsd_raw_756_p"          
 [99] "ksads_ptsd_raw_757_p"           "ksads_ptsd_raw_758_p"          
[101] "ksads_ptsd_raw_759_p"           "ksads_ptsd_raw_760_p"          
[103] "ksads_ptsd_raw_761_p"           "ksads_ptsd_raw_762_p"          
[105] "ksads_ptsd_raw_763_p"           "ksads_ptsd_raw_764_p"          
[107] "ksads_ptsd_raw_765_p"           "ksads_ptsd_raw_766_p"          
[109] "ksads_ptsd_raw_767_p"           "ksads_ptsd_raw_768_p"          
[111] "ksads_ptsd_raw_769_p"           "ksads_ptsd_raw_770_p"          
[113] "ksads_ptsd_accident"            "ksads_ptsd_wit_viol"           
[115] "ksads_ptsd_thr_viol"            "ksads_ptsd_phys_abuse"         
[117] "ksads_ptsd_sexual_abuse"        "kbi_p_c_bully"                 
[119] "famhx_ss_fath_prob_alc_p"       "famhx_ss_moth_prob_alc_p"      
[121] "famhx_ss_moth_prob_dg_p"        "famhx_ss_fath_prob_dg_p"       
[123] "famhx_ss_fath_prob_prf_p"       "famhx_ss_moth_prob_prf_p"      
[125] "famhx_ss_moth_prob_hspd_p"      "famhx_ss_fath_prob_hspd_p"     
[127] "asr_q06_p"                      "asr_q90_p"                     
[129] "asr_q126_p"                     "asr_scr_anxdep_t"              
[131] "asr_scr_withdrawn_t"            "asr_scr_somatic_t"             
[133] "asr_scr_thought_t"              "asr_scr_attention_t"           
[135] "asr_scr_aggressive_t"           "asr_scr_rulebreak_t"           
[137] "asr_scr_intrusive_t"            "pubertal_sex_p"                
[139] "pds_p_ss_cat"                   "birth_weight"                  
[141] "devhx_3_p"                      "devhx_4_p"                     
[143] "devhx_6_p"                      "preg_any_subst"                
[145] "devhx_10"                       "preg_caffeine"                 
[147] "birth_complications"            "devhx_13_3_p"                  
[149] "devhx_18_p"                     "physical_activity1_y"          
[151] "physical_activity5_y"           "sai_p_activities___24"         
[153] "sai_p_perf_arts"                "sai_p_team_sports"             
[155] "sai_p_non_team_sports"          "sai_p_other"                   
[157] "sai_p_any"                      "sds_p_ss_dims"                 
[159] "sds_p_ss_sbd"                   "sds_p_ss_da"                   
[161] "sds_p_ss_swtd"                  "sds_p_ss_does"                 
[163] "sds_p_ss_shy"                   "sds_p_ss_total"                
[165] "screentime1_p_hours"            "screentime2_p_hours"           
[167] "bis_y_ss_bas_drive"             "bis_y_ss_bas_fs"               
[169] "bis_y_ss_bas_rr"                "bis_y_ss_bis_sum"              
[171] "upps_y_ss_positive_urgency"     "upps_y_ss_negative_urgency"    
[173] "upps_y_ss_lack_of_planning"     "upps_y_ss_lack_of_perseverance"
[175] "upps_y_ss_sensation_seeking"    "cbcl_scr_syn_anxdep_r"         
[177] "cbcl_scr_syn_withdep_r"         "cbcl_scr_syn_somatic_r"        
[179] "cbcl_scr_syn_social_r"          "cbcl_scr_syn_thought_r"        
[181] "cbcl_scr_syn_attention_r"       "cbcl_scr_syn_rulebreak_r"      
[183] "cbcl_scr_syn_aggressive_r"      "num_friends"                   
[185] "num_close_friends"              "parent_su_comm_risk"           
[187] "parent_subst_rules"             "parent_no_subst_rules"         
[189] "peer_deviance"                  "some_peer_deviance"            
[191] "profile"                        "resilience"                    
> new_tr <- as.matrix(d_flpov[,c(2,28:190)])
> 
> dtrain <- xgb.DMatrix(data = new_tr,label = labels) 
> 
> 
> params <- list(booster = "gbtree", objective = "binary:logistic", 
+                eta=0.1, gamma=0.1, max_depth=2, 
+                min_child_weight=1, 
+                subsample=1, colsample_bytree=1)
> 
> xgbcv <- xgb.cv(params = params, data = dtrain, nrounds = 50, 
+                 nfold = 10,print_every_n = 10, 
+                 prediction=TRUE,
+                 maximize = F, eval="error")
[1]	train-logloss:0.679804+0.000255	test-logloss:0.681030+0.001170 
[11]	train-logloss:0.619936+0.001144	test-logloss:0.630223+0.007601 
[21]	train-logloss:0.599934+0.001208	test-logloss:0.617560+0.009024 
[31]	train-logloss:0.587577+0.001180	test-logloss:0.611683+0.009927 
[41]	train-logloss:0.577900+0.001151	test-logloss:0.608764+0.009635 
[50]	train-logloss:0.570110+0.001033	test-logloss:0.606122+0.009524 
> xgbpred <- xgbcv$pred
> 
> summary(xgbpred)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.09378 0.26326 0.33746 0.34402 0.41489 0.70742 
> hist(xgbpred)
> roc_test <- roc(labels, xgbpred, algorithm = 2) 
Setting levels: control = 0, case = 1
Setting direction: controls < cases
> roc_test$auc
Area under the curve: 0.6661
> 
> 
> #-- Assess variable importance
> 
> xgb_util <- xgboost(data = new_tr, label = xgbpred, nrounds = 50, verbose=FALSE,params = params)
> importance_matrix_util <- xgb.importance(model = xgb_util)
> importance_matrix_util
                         Feature         Gain        Cover   Frequency
 1: reshist_addr1_seg_ice_income 0.2134101580 0.0474548094 0.034246575
 2: reshist_addr1_seg_ice_inc_bw 0.1772357507 0.0849949363 0.068493151
 3:     cbcl_scr_syn_attention_r 0.1377698640 0.1506938082 0.184931507
 4:                   devhx_18_p 0.0704927467 0.0799465932 0.075342466
 5:       reshist_addr1_adi_perc 0.0600700596 0.0469955928 0.034246575
 6:                          inr 0.0556907190 0.0657933060 0.054794521
 7:                interview_age 0.0455835916 0.0966749291 0.082191781
 8:             demo_prtnr_ed_v2 0.0428935020 0.0408533040 0.034246575
 9:   upps_y_ss_positive_urgency 0.0370474947 0.0607740790 0.054794521
10:              demo_prnt_ed_v2 0.0342621432 0.0384546344 0.034246575
11:     reshist_addr1_coi_se_mhe 0.0245603421 0.0204147386 0.013698630
12: reshist_addr1_coi_ed_college 0.0184039821 0.0409927788 0.061643836
13:          screentime2_p_hours 0.0170266623 0.0555906392 0.054794521
14: reshist_addr1_coi_he_vacancy 0.0149598441 0.0337219492 0.027397260
15:  reshist_addr1_coi_se_public 0.0099437013 0.0246466510 0.020547945
16:          screentime1_p_hours 0.0095497498 0.0304530915 0.034246575
17: reshist_addr1_coi_se_povrate 0.0076986947 0.0116683514 0.027397260
18:  reshist_addr1_coi_se_single 0.0064953852 0.0055704757 0.006849315
19:                peer_deviance 0.0048787018 0.0200218334 0.027397260
20:                 birth_weight 0.0029679817 0.0149592960 0.013698630
21:        cbcl_scr_syn_anxdep_r 0.0018669496 0.0042913783 0.006849315
22:                    devhx_3_p 0.0018398930 0.0096145230 0.006849315
23:             bis_y_ss_bis_sum 0.0014437937 0.0067019683 0.006849315
24:       reshist_addr1_leadrisk 0.0010231172 0.0013151054 0.006849315
25:            num_close_friends 0.0009333211 0.0029287262 0.006849315
26:  reshist_state_racism_factor 0.0007882701 0.0019835267 0.006849315
27:     reshist_addr1_popdensity 0.0006852100 0.0008910765 0.006849315
28: reshist_addr1_coi_ed_reading 0.0004783708 0.0015978984 0.006849315
                         Feature         Gain        Cover   Frequency
> ## Create table comparing distributions of top 20 important variables by any_util
> vars <- as.vector(unlist(importance_matrix_util[1:20,1]))
> imp <- data.frame(importance_matrix_util)
> names(imp) <- c("Variable","Gain","Cover","Frequency")
> 
> table_util_imp <- CreateTableOne(vars = vars,
+                                  strata = c("resilience"), 
+                                  includeNA = F, 
+                                  addOverall = F,
+                                  data = d_flpov)
> table_util_imp <- data.frame(print(table_util_imp, explain=F, missing=T, catDigits = 2, contDigits = 2))
                              Stratified by resilience
                               0                   1                   p     
  n                                2215                1158                  
  reshist_addr1_seg_ice_income    -0.09 (0.28)         0.01 (0.27)     <0.001
  reshist_addr1_seg_ice_inc_bw     0.01 (0.25)         0.10 (0.22)     <0.001
  cbcl_scr_syn_attention_r         3.80 (3.93)         2.78 (3.43)     <0.001
  devhx_18_p                       5.46 (7.59)         7.09 (8.29)     <0.001
  reshist_addr1_adi_perc          59.28 (27.77)       50.61 (26.49)    <0.001
  inr                              0.95 (0.59)         1.12 (0.58)     <0.001
  interview_age                  118.29 (7.33)       119.31 (7.65)     <0.001
  demo_prtnr_ed_v2                12.90 (2.55)        13.54 (2.70)     <0.001
  upps_y_ss_positive_urgency       8.73 (3.14)         8.03 (3.05)     <0.001
  demo_prnt_ed_v2                 13.30 (2.25)        13.92 (2.21)     <0.001
  reshist_addr1_coi_se_mhe     49104.65 (23221.48) 56767.40 (24274.42) <0.001
  reshist_addr1_coi_ed_college    44.59 (10.71)       43.38 (10.29)     0.003
  screentime2_p_hours              4.57 (3.23)         4.27 (2.78)      0.008
  reshist_addr1_coi_he_vacancy     9.97 (8.00)         7.70 (6.39)     <0.001
  reshist_addr1_coi_se_public     22.65 (16.02)       17.35 (12.90)    <0.001
  screentime1_p_hours              3.22 (2.91)         2.85 (2.54)     <0.001
  reshist_addr1_coi_se_povrate    21.96 (14.20)       17.38 (12.02)    <0.001
  reshist_addr1_coi_se_single     47.18 (21.99)       40.42 (20.03)    <0.001
  peer_deviance                    0.22 (1.18)         0.15 (0.67)      0.073
  birth_weight                     6.85 (1.44)         7.09 (1.44)     <0.001
                              Stratified by resilience
                               test Missing
  n                                        
  reshist_addr1_seg_ice_income       5.9   
  reshist_addr1_seg_ice_inc_bw       5.9   
  cbcl_scr_syn_attention_r           0.0   
  devhx_18_p                         5.0   
  reshist_addr1_adi_perc             7.5   
  inr                                0.0   
  interview_age                      0.0   
  demo_prtnr_ed_v2                   0.1   
  upps_y_ss_positive_urgency         0.2   
  demo_prnt_ed_v2                    0.1   
  reshist_addr1_coi_se_mhe          11.0   
  reshist_addr1_coi_ed_college      11.2   
  screentime2_p_hours                1.1   
  reshist_addr1_coi_he_vacancy      10.9   
  reshist_addr1_coi_se_public       10.9   
  screentime1_p_hours                1.2   
  reshist_addr1_coi_se_povrate      10.9   
  reshist_addr1_coi_se_single       10.9   
  peer_deviance                      4.3   
  birth_weight                      12.5   
> table_util_imp <- tibble::rownames_to_column(table_util_imp, "Characteristic")[,c(1:5)]
> table_util_imp
                 Characteristic                  X0                  X1      p
1                             n                2215                1158       
2  reshist_addr1_seg_ice_income        -0.09 (0.28)         0.01 (0.27) <0.001
3  reshist_addr1_seg_ice_inc_bw         0.01 (0.25)         0.10 (0.22) <0.001
4      cbcl_scr_syn_attention_r         3.80 (3.93)         2.78 (3.43) <0.001
5                    devhx_18_p         5.46 (7.59)         7.09 (8.29) <0.001
6        reshist_addr1_adi_perc       59.28 (27.77)       50.61 (26.49) <0.001
7                           inr         0.95 (0.59)         1.12 (0.58) <0.001
8                 interview_age       118.29 (7.33)       119.31 (7.65) <0.001
9              demo_prtnr_ed_v2        12.90 (2.55)        13.54 (2.70) <0.001
10   upps_y_ss_positive_urgency         8.73 (3.14)         8.03 (3.05) <0.001
11              demo_prnt_ed_v2        13.30 (2.25)        13.92 (2.21) <0.001
12     reshist_addr1_coi_se_mhe 49104.65 (23221.48) 56767.40 (24274.42) <0.001
13 reshist_addr1_coi_ed_college       44.59 (10.71)       43.38 (10.29)  0.003
14          screentime2_p_hours         4.57 (3.23)         4.27 (2.78)  0.008
15 reshist_addr1_coi_he_vacancy         9.97 (8.00)         7.70 (6.39) <0.001
16  reshist_addr1_coi_se_public       22.65 (16.02)       17.35 (12.90) <0.001
17          screentime1_p_hours         3.22 (2.91)         2.85 (2.54) <0.001
18 reshist_addr1_coi_se_povrate       21.96 (14.20)       17.38 (12.02) <0.001
19  reshist_addr1_coi_se_single       47.18 (21.99)       40.42 (20.03) <0.001
20                peer_deviance         0.22 (1.18)         0.15 (0.67)  0.073
21                 birth_weight         6.85 (1.44)         7.09 (1.44) <0.001
   test
1      
2      
3      
4      
5      
6      
7      
8      
9      
10     
11     
12     
13     
14     
15     
16     
17     
18     
19     
20     
21     
> 
> names(table_util_imp) <- c("Variable", "Poverty_Low_Cog", "Poverty_High_Cog","p_value","prop_missing")
> 
> table_util_imp_label <- merge(x=table_util_imp, y=dict, by="Variable",all.x=T) %>%
+   dplyr::select(Label,Variable,Poverty_Low_Cog,Poverty_High_Cog,p_value)
> 
> table_util_imp_label_gain <- merge(x=table_util_imp_label, y=imp, all.x=T, by="Variable")
> table_util_imp_label_gain
                       Variable
1                  birth_weight
2      cbcl_scr_syn_attention_r
3               demo_prnt_ed_v2
4              demo_prtnr_ed_v2
5                    devhx_18_p
6                           inr
7                 interview_age
8                             n
9                 peer_deviance
10       reshist_addr1_adi_perc
11 reshist_addr1_coi_ed_college
12 reshist_addr1_coi_he_vacancy
13     reshist_addr1_coi_se_mhe
14 reshist_addr1_coi_se_povrate
15  reshist_addr1_coi_se_public
16  reshist_addr1_coi_se_single
17 reshist_addr1_seg_ice_inc_bw
18 reshist_addr1_seg_ice_income
19          screentime1_p_hours
20          screentime2_p_hours
21   upps_y_ss_positive_urgency
                                                                                                                                                                                                                                                                                                                                                     Label
1                                                                                                                                                                                                                                                                                                      Developmental history quesitonnaire: birth weight: 
2                                                                                                                                                                                                                                                   Child dimensional psychopathology - CBCL -  parent-reported: Attention CBCL Syndrome Scale (raw score)
3                                                                                                                                                                                                                         Parental ed - primary: What is the highest grade or level of school you have completed or the highest degree you have received? 
4                                                                                                                                                                               Parental ed - secondary: What is the highest grade or level of school your partner completed or highest degree they received? (imputed with parent's education if missing)
5                                                                                                                                                                                                                                                                                       Developmental history questionnaire: nuumber of months breastfed: 
6                                                                                                                                                                                                                                                                                                                                                      INR
7                                                                                                                                                                                                                                                                                                                                                     <NA>
8                                                                                                                                                                                                                                                                                                                                                        n
9                                                                                                                                                                                                                                                                                           Peer deviance (youth-reported): Continuous peer deviance score
10                                                                                                                                                                                                                                                    Neightbohood quality: Area Deprivation Index (national percentiles, higher means higher deprivation)
11                                                                                                                                                                                                                  Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Education Domain: College enrollment in nearby institutions
12                                                                                                                                                                                                                          Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Health and Environment Domain: Housing vacancy rate
13                                                                                                                                                                                                                          Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Social and Economic Domain: Median household income
14                                                                                                                                                                                                                                     Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Social and Economic Domain: Poverty rate
15                                                                                                                                                                                                                           Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Social and Economic Domain: Public assistance rate
16                                                                                                                                                                                                                         Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Social and Economic Domain: Single-headed households
17                                  Neighborhood: residential segregation - Index of Concentrations at the Extremes: Residential history derived- Index of Concentration at the Extremes(Income+ BW), (non-Hispanic white Households income >= $100k) - (non-Hispanic Black Households income < $25k)/total population, ACS2014-2018; census tract (addr1)
18                                                                           Neighborhood: residential segregation - Index of Concentrations at the Extremes: Residential history derived- Index of Concentration at the Extremes (income), (Households income >= $100k) - (Households income < $25k)/total population, ACS2014-2018; census tract (addr1)
19     Screen time: On a typical WEEKDAY, how much TIME does your child spend on a computer, cellphone, tablet, or other electronic device? (Please do NOT include time spent on school related work, but do include watching TV, shows or videos, texting or chatting, playing games, or visiting social networking sites (Facebook, Twitter, Instagram).
20 Screen time: On a typical WEEKEND DAY, how much TIME does your child spend on a computer, cellphone, tablet, or other electronic device? (Please do NOT include time spent on school related work, but do include watching TV, shows or videos, texting or chatting, playing games, or visiting social networking sites (Facebook, Twitter, Instagram).
21                                                                                                                                             Temperament/Personality: UPPS-P (Urgency, Premeditation, Perseverance, Sensation Seeking, Positive Urgency, Impulsive behavior scale): Positive Urgency: tendency to act impulsively due to positive affect
       Poverty_Low_Cog    Poverty_High_Cog p_value        Gain       Cover
1          6.85 (1.44)         7.09 (1.44)  <0.001 0.002967982 0.014959296
2          3.80 (3.93)         2.78 (3.43)  <0.001 0.137769864 0.150693808
3         13.30 (2.25)        13.92 (2.21)  <0.001 0.034262143 0.038454634
4         12.90 (2.55)        13.54 (2.70)  <0.001 0.042893502 0.040853304
5          5.46 (7.59)         7.09 (8.29)  <0.001 0.070492747 0.079946593
6          0.95 (0.59)         1.12 (0.58)  <0.001 0.055690719 0.065793306
7        118.29 (7.33)       119.31 (7.65)  <0.001 0.045583592 0.096674929
8                 2215                1158                  NA          NA
9          0.22 (1.18)         0.15 (0.67)   0.073 0.004878702 0.020021833
10       59.28 (27.77)       50.61 (26.49)  <0.001 0.060070060 0.046995593
11       44.59 (10.71)       43.38 (10.29)   0.003 0.018403982 0.040992779
12         9.97 (8.00)         7.70 (6.39)  <0.001 0.014959844 0.033721949
13 49104.65 (23221.48) 56767.40 (24274.42)  <0.001 0.024560342 0.020414739
14       21.96 (14.20)       17.38 (12.02)  <0.001 0.007698695 0.011668351
15       22.65 (16.02)       17.35 (12.90)  <0.001 0.009943701 0.024646651
16       47.18 (21.99)       40.42 (20.03)  <0.001 0.006495385 0.005570476
17         0.01 (0.25)         0.10 (0.22)  <0.001 0.177235751 0.084994936
18        -0.09 (0.28)         0.01 (0.27)  <0.001 0.213410158 0.047454809
19         3.22 (2.91)         2.85 (2.54)  <0.001 0.009549750 0.030453092
20         4.57 (3.23)         4.27 (2.78)   0.008 0.017026662 0.055590639
21         8.73 (3.14)         8.03 (3.05)  <0.001 0.037047495 0.060774079
     Frequency
1  0.013698630
2  0.184931507
3  0.034246575
4  0.034246575
5  0.075342466
6  0.054794521
7  0.082191781
8           NA
9  0.027397260
10 0.034246575
11 0.061643836
12 0.027397260
13 0.013698630
14 0.027397260
15 0.020547945
16 0.006849315
17 0.068493151
18 0.034246575
19 0.034246575
20 0.054794521
21 0.054794521
> 
> write.csv(table_util_imp_label_gain,"/Users/Kat/Library/CloudStorage/OneDrive-HarvardUniversity/abcd_study_with_kat/results/INR_tert_fluid_cvXgb_table_util_Missing_label_gain.csv")
> 
> 
> 
> #-- Run a logistic regression with the top 20 important predictors selected by xgboost
> glm_cvxgboost = glm(data=d_flpov, formula(paste("resilience ~ ",paste(table_util_imp$Variable[2:21], collapse ="+"), collapse = " ")), family="binomial")
> 
> summary(glm_cvxgboost)

Call:
glm(formula = formula(paste("resilience ~ ", paste(table_util_imp$Variable[2:21], 
    collapse = "+"), collapse = " ")), family = "binomial", data = d_flpov)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.5964  -0.9496  -0.7165   1.2096   2.2952  

Coefficients:
                               Estimate Std. Error z value Pr(>|z|)    
(Intercept)                  -3.405e+00  9.617e-01  -3.540 0.000400 ***
reshist_addr1_seg_ice_income  7.610e-01  6.923e-01   1.099 0.271689    
reshist_addr1_seg_ice_inc_bw  7.878e-01  4.862e-01   1.620 0.105181    
cbcl_scr_syn_attention_r     -6.887e-02  1.312e-02  -5.251 1.52e-07 ***
devhx_18_p                    9.280e-03  5.875e-03   1.579 0.114224    
reshist_addr1_adi_perc       -3.386e-03  3.030e-03  -1.117 0.263795    
inr                           1.203e-01  8.514e-02   1.414 0.157488    
interview_age                 1.781e-02  5.988e-03   2.974 0.002935 ** 
demo_prtnr_ed_v2              2.984e-02  2.253e-02   1.324 0.185427    
upps_y_ss_positive_urgency   -4.228e-02  1.502e-02  -2.814 0.004885 ** 
demo_prnt_ed_v2               6.763e-02  2.734e-02   2.474 0.013352 *  
reshist_addr1_coi_se_mhe     -7.802e-06  6.198e-06  -1.259 0.208119    
reshist_addr1_coi_ed_college -9.786e-03  4.557e-03  -2.147 0.031755 *  
screentime2_p_hours           8.170e-03  1.855e-02   0.441 0.659564    
reshist_addr1_coi_he_vacancy -1.835e-02  9.280e-03  -1.978 0.047955 *  
reshist_addr1_coi_se_public   3.606e-04  6.713e-03   0.054 0.957159    
screentime1_p_hours          -2.806e-02  2.097e-02  -1.338 0.180792    
reshist_addr1_coi_se_povrate -2.046e-03  7.725e-03  -0.265 0.791134    
reshist_addr1_coi_se_single   6.425e-03  4.005e-03   1.604 0.108640    
peer_deviance                -2.068e-02  5.923e-02  -0.349 0.726930    
birth_weight                  1.058e-01  3.193e-02   3.313 0.000922 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 3084.2  on 2356  degrees of freedom
Residual deviance: 2890.7  on 2336  degrees of freedom
  (1016 observations deleted due to missingness)
AIC: 2932.7

Number of Fisher Scoring iterations: 4

> 
> pred <- predict(glm_cvxgboost, newdata=d_flpov, type="response")
> roc_test <- roc(labels, pred, algorithm = 2) 
Setting levels: control = 0, case = 1
Setting direction: controls < cases
> roc_test$auc
Area under the curve: 0.6657
> 
> #----------------------------------------------------#
> #-- cross-validated XGBoost in complete cases data --#
> 
> 
> d_pov_highflcog <- dat_all_inr_complete %>% filter(pov3_highflcog==1) %>% 
+   mutate(profile="pov3_highflcog",
+          resilience=1)
> d_pov_lowflcog <- dat_all_inr_complete %>% filter(pov3_lowflcog==1) %>% 
+   mutate(profile="pov3_lowflcog",
+          resilience=0)
> 
> d_flpov <- rbind(d_pov_highflcog,d_pov_lowflcog)
> 
> set.seed(123)
> labels <- d_flpov$resilience
> 
> names(d_flpov)
  [1] "src_subject_id"                 "inr"                           
  [3] "nihtbx_fluidcomp_agecorrected"  "nihtbx_cryst_agecorrected"     
  [5] "nihtbx_totalcomp_agecorrected"  "fluid_s"                       
  [7] "cryst_s"                        "totcomp_s"                     
  [9] "inr_quart"                      "inr_tert"                      
 [11] "pov_highflcog"                  "pov_lowflcog"                  
 [13] "welloff_highflcog"              "welloff_lowflcog"              
 [15] "pov_highcrcog"                  "pov_lowcrcog"                  
 [17] "welloff_highcrcog"              "welloff_lowcrcog"              
 [19] "pov3_highflcog"                 "pov3_lowflcog"                 
 [21] "welloff3_highflcog"             "welloff3_lowflcog"             
 [23] "pov3_highcrcog"                 "pov3_lowcrcog"                 
 [25] "welloff3_highcrcog"             "welloff3_lowcrcog"             
 [27] "rel_family_id"                  "interview_age"                 
 [29] "srpf_y_ss_ses"                  "nsc_p_ss_mean_3_items"         
 [31] "fes_p_ss_fc"                    "fes_y_ss_fc"                   
 [33] "crpbi_y_ss_parent"              "crpbi_y_ss_caregiver"          
 [35] "pmq_y_ss_mean"                  "psb_p_ss_mean"                 
 [37] "psb_y_ss_mean"                  "reshist_addr1_coi_ed_attain"   
 [39] "reshist_addr1_coi_ed_apenr"     "reshist_addr1_coi_ed_college"  
 [41] "reshist_addr1_coi_ed_prxece"    "reshist_addr1_coi_ed_ecenrol"  
 [43] "reshist_addr1_coi_ed_hsgrad"    "reshist_addr1_coi_ed_prxhqece" 
 [45] "reshist_addr1_coi_ed_schpov"    "reshist_addr1_coi_ed_teachxp"  
 [47] "reshist_addr1_coi_ed_math"      "reshist_addr1_coi_ed_reading"  
 [49] "reshist_addr1_coi_he_green"     "reshist_addr1_coi_he_food"     
 [51] "reshist_addr1_coi_he_pm25"      "reshist_addr1_coi_he_heat"     
 [53] "reshist_addr1_coi_he_suprfnd"   "reshist_addr1_coi_he_hlthins"  
 [55] "reshist_addr1_coi_he_vacancy"   "reshist_addr1_coi_he_rsei"     
 [57] "reshist_addr1_coi_he_ozone"     "reshist_addr1_coi_he_walk"     
 [59] "reshist_addr1_coi_se_jobprox"   "reshist_addr1_coi_se_emprat"   
 [61] "reshist_addr1_coi_se_occ"       "reshist_addr1_coi_se_home"     
 [63] "reshist_addr1_coi_se_mhe"       "reshist_addr1_coi_se_povrate"  
 [65] "reshist_addr1_coi_se_public"    "reshist_addr1_coi_se_single"   
 [67] "reshist_addr1_adi_perc"         "reshist_addr1_popdensity"      
 [69] "reshist_addr1_urban_area"       "reshist_addr1_walkindex"       
 [71] "reshist_addr1_traffic_count"    "reshist_addr1_proxrd"          
 [73] "reshist_addr1_svi_tot_20142018" "reshist_addr1_p1vlnt"          
 [75] "reshist_addr1_leadrisk"         "reshist_addr1_urbsat_ntl"      
 [77] "reshist_addr1_seg_diss_nww_m"   "reshist_addr1_seg_inter_nww_m" 
 [79] "reshist_addr1_seg_ice_income"   "reshist_addr1_seg_ice_inc_bw"  
 [81] "reshist_addr1_seg_entropy_t"    "reshist_state_racism_factor"   
 [83] "reshist_state_so_factor"        "reshist_state_sexism_factor"   
 [85] "reshist_addr1_ACAexpand"        "demo_mar_livingwith"           
 [87] "demo_prnt_ed_v2"                "demo_prtnr_ed_v2"              
 [89] "demo_fam_exp1_v2"               "demo_fam_exp2_v2"              
 [91] "demo_fam_exp3_v2"               "demo_fam_exp4_v2"              
 [93] "demo_fam_exp5_v2"               "demo_fam_exp6_v2"              
 [95] "demo_fam_exp7_v2"               "ksads_ptsd_raw_754_p"          
 [97] "ksads_ptsd_raw_755_p"           "ksads_ptsd_raw_756_p"          
 [99] "ksads_ptsd_raw_757_p"           "ksads_ptsd_raw_758_p"          
[101] "ksads_ptsd_raw_759_p"           "ksads_ptsd_raw_760_p"          
[103] "ksads_ptsd_raw_761_p"           "ksads_ptsd_raw_762_p"          
[105] "ksads_ptsd_raw_763_p"           "ksads_ptsd_raw_764_p"          
[107] "ksads_ptsd_raw_765_p"           "ksads_ptsd_raw_766_p"          
[109] "ksads_ptsd_raw_767_p"           "ksads_ptsd_raw_768_p"          
[111] "ksads_ptsd_raw_769_p"           "ksads_ptsd_raw_770_p"          
[113] "ksads_ptsd_accident"            "ksads_ptsd_wit_viol"           
[115] "ksads_ptsd_thr_viol"            "ksads_ptsd_phys_abuse"         
[117] "ksads_ptsd_sexual_abuse"        "kbi_p_c_bully"                 
[119] "famhx_ss_fath_prob_alc_p"       "famhx_ss_moth_prob_alc_p"      
[121] "famhx_ss_moth_prob_dg_p"        "famhx_ss_fath_prob_dg_p"       
[123] "famhx_ss_fath_prob_prf_p"       "famhx_ss_moth_prob_prf_p"      
[125] "famhx_ss_moth_prob_hspd_p"      "famhx_ss_fath_prob_hspd_p"     
[127] "asr_q06_p"                      "asr_q90_p"                     
[129] "asr_q126_p"                     "asr_scr_anxdep_t"              
[131] "asr_scr_withdrawn_t"            "asr_scr_somatic_t"             
[133] "asr_scr_thought_t"              "asr_scr_attention_t"           
[135] "asr_scr_aggressive_t"           "asr_scr_rulebreak_t"           
[137] "asr_scr_intrusive_t"            "pubertal_sex_p"                
[139] "pds_p_ss_cat"                   "birth_weight"                  
[141] "devhx_3_p"                      "devhx_4_p"                     
[143] "devhx_6_p"                      "preg_any_subst"                
[145] "devhx_10"                       "preg_caffeine"                 
[147] "birth_complications"            "devhx_13_3_p"                  
[149] "devhx_18_p"                     "physical_activity1_y"          
[151] "physical_activity5_y"           "sai_p_activities___24"         
[153] "sai_p_perf_arts"                "sai_p_team_sports"             
[155] "sai_p_non_team_sports"          "sai_p_other"                   
[157] "sai_p_any"                      "sds_p_ss_dims"                 
[159] "sds_p_ss_sbd"                   "sds_p_ss_da"                   
[161] "sds_p_ss_swtd"                  "sds_p_ss_does"                 
[163] "sds_p_ss_shy"                   "sds_p_ss_total"                
[165] "screentime1_p_hours"            "screentime2_p_hours"           
[167] "bis_y_ss_bas_drive"             "bis_y_ss_bas_fs"               
[169] "bis_y_ss_bas_rr"                "bis_y_ss_bis_sum"              
[171] "upps_y_ss_positive_urgency"     "upps_y_ss_negative_urgency"    
[173] "upps_y_ss_lack_of_planning"     "upps_y_ss_lack_of_perseverance"
[175] "upps_y_ss_sensation_seeking"    "cbcl_scr_syn_anxdep_r"         
[177] "cbcl_scr_syn_withdep_r"         "cbcl_scr_syn_somatic_r"        
[179] "cbcl_scr_syn_social_r"          "cbcl_scr_syn_thought_r"        
[181] "cbcl_scr_syn_attention_r"       "cbcl_scr_syn_rulebreak_r"      
[183] "cbcl_scr_syn_aggressive_r"      "num_friends"                   
[185] "num_close_friends"              "parent_su_comm_risk"           
[187] "parent_subst_rules"             "parent_no_subst_rules"         
[189] "peer_deviance"                  "some_peer_deviance"            
[191] "profile"                        "resilience"                    
> new_tr <- as.matrix(d_flpov[,c(2,28:190)])
> 
> dtrain <- xgb.DMatrix(data = new_tr,label = labels) 
> 
> params <- list(booster = "gbtree", objective = "binary:logistic", 
+                eta=0.1, gamma=0.1, max_depth=2, 
+                min_child_weight=1, 
+                subsample=1, colsample_bytree=1)
> 
> xgbcv <- xgb.cv(params = params, data = dtrain, nrounds = 50, 
+                 nfold = 10,print_every_n = 10, 
+                 prediction=TRUE,
+                 maximize = F, eval="error")
[1]	train-logloss:0.680710+0.000577	test-logloss:0.682787+0.002570 
[11]	train-logloss:0.620230+0.002801	test-logloss:0.642198+0.020623 
[21]	train-logloss:0.594423+0.003382	test-logloss:0.634519+0.029175 
[31]	train-logloss:0.576528+0.003638	test-logloss:0.634417+0.033213 
[41]	train-logloss:0.561425+0.003615	test-logloss:0.635559+0.037104 
[50]	train-logloss:0.549740+0.004133	test-logloss:0.636955+0.039024 
> xgbpred <- xgbcv$pred
> 
> summary(xgbpred)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.08188 0.27872 0.36537 0.37005 0.45198 0.70821 
> hist(xgbpred)
> roc_test <- roc(labels, xgbpred, algorithm = 2) 
Setting levels: control = 0, case = 1
Setting direction: controls < cases
> roc_test$auc
Area under the curve: 0.6238
> 
> 
> #-- Assess variable importance
> 
> xgb_util <- xgboost(data = new_tr, label = xgbpred, nrounds = 50, verbose=FALSE,params=params)
> importance_matrix_util <- xgb.importance(model = xgb_util)
> importance_matrix_util
                         Feature         Gain        Cover   Frequency
 1: reshist_addr1_seg_ice_inc_bw 0.2017962940 0.0716142835 0.054794521
 2:     cbcl_scr_syn_attention_r 0.1953694107 0.1996181522 0.226027397
 3: reshist_addr1_seg_ice_income 0.1811845452 0.0449984585 0.034246575
 4:                   devhx_18_p 0.1166562045 0.0921354288 0.095890411
 5:                          inr 0.0861628739 0.0928406477 0.068493151
 6:                interview_age 0.0539483361 0.1118814352 0.123287671
 7:     reshist_addr1_coi_se_mhe 0.0351490955 0.0301884417 0.020547945
 8: reshist_addr1_coi_he_vacancy 0.0252962320 0.0541044519 0.047945205
 9: reshist_addr1_coi_se_povrate 0.0212594874 0.0491259891 0.034246575
10:                 birth_weight 0.0201134809 0.0663138026 0.068493151
11:       reshist_addr1_adi_perc 0.0094320543 0.0131760063 0.020547945
12:  reshist_addr1_coi_se_public 0.0092466514 0.0167960218 0.013698630
13:   upps_y_ss_positive_urgency 0.0071039693 0.0292451676 0.020547945
14:          screentime1_p_hours 0.0070376219 0.0248135165 0.047945205
15:  reshist_addr1_coi_ed_schpov 0.0056989518 0.0143638799 0.013698630
16:             demo_prtnr_ed_v2 0.0050059882 0.0166594344 0.020547945
17:              demo_prnt_ed_v2 0.0044105697 0.0160783169 0.013698630
18:    reshist_addr1_coi_ed_math 0.0040183495 0.0086665614 0.006849315
19:  reshist_addr1_coi_se_single 0.0038444293 0.0114420782 0.013698630
20:  reshist_state_sexism_factor 0.0015641780 0.0096925301 0.006849315
21:  reshist_addr1_coi_ed_attain 0.0012314122 0.0072143870 0.006849315
22: reshist_addr1_coi_ed_reading 0.0011060591 0.0045146088 0.006849315
23:                    devhx_4_p 0.0009694619 0.0051683687 0.006849315
24: reshist_addr1_coi_he_hlthins 0.0007707108 0.0028897268 0.006849315
25:         physical_activity1_y 0.0007143031 0.0041399112 0.006849315
26: reshist_addr1_coi_ed_college 0.0005215080 0.0014403832 0.006849315
27:              bis_y_ss_bas_fs 0.0003878214 0.0008780102 0.006849315
                         Feature         Gain        Cover   Frequency
> ## Create table comparing distributions of top 20 important variables by any_util
> vars <- as.vector(unlist(importance_matrix_util[1:20,1]))
> imp <- data.frame(importance_matrix_util)
> names(imp) <- c("Variable","Gain","Cover","Frequency")
> 
> table_util_imp <- CreateTableOne(vars = vars,
+                                  strata = c("resilience"), 
+                                  includeNA = F, 
+                                  addOverall = F,
+                                  data = d_flpov)
> table_util_imp <- data.frame(print(table_util_imp, explain=F, missing=T, catDigits = 2, contDigits = 2))
                              Stratified by resilience
                               0                   1                   p     
  n                                 860                 505                  
  reshist_addr1_seg_ice_inc_bw     0.02 (0.23)         0.11 (0.22)     <0.001
  cbcl_scr_syn_attention_r         3.70 (3.99)         2.41 (3.11)     <0.001
  reshist_addr1_seg_ice_income    -0.07 (0.27)         0.03 (0.26)     <0.001
  devhx_18_p                       5.43 (7.30)         7.16 (7.73)     <0.001
  inr                              1.01 (0.59)         1.19 (0.56)     <0.001
  interview_age                  118.40 (7.41)       119.53 (7.74)      0.007
  reshist_addr1_coi_se_mhe     50375.87 (22433.40) 57552.29 (23247.70) <0.001
  reshist_addr1_coi_he_vacancy     9.47 (7.41)         7.52 (6.48)     <0.001
  reshist_addr1_coi_se_povrate    20.83 (12.93)       16.79 (11.43)    <0.001
  birth_weight                     6.85 (1.45)         7.12 (1.43)      0.001
  reshist_addr1_adi_perc          57.86 (27.55)       49.81 (25.98)    <0.001
  reshist_addr1_coi_se_public     21.51 (14.58)       16.52 (12.46)    <0.001
  upps_y_ss_positive_urgency       8.58 (3.01)         7.96 (3.04)     <0.001
  screentime1_p_hours              3.15 (2.80)         2.70 (2.31)      0.003
  reshist_addr1_coi_ed_schpov     67.59 (24.25)       60.21 (25.58)    <0.001
  demo_prtnr_ed_v2                13.17 (2.47)        13.78 (2.55)     <0.001
  demo_prnt_ed_v2                 13.55 (2.04)        14.08 (2.14)     <0.001
  reshist_addr1_coi_ed_math      187.98 (65.90)      209.08 (68.47)    <0.001
  reshist_addr1_coi_se_single     45.97 (21.60)       39.63 (20.08)    <0.001
  reshist_state_sexism_factor      0.00 (0.85)         0.05 (0.92)      0.292
                              Stratified by resilience
                               test Missing
  n                                        
  reshist_addr1_seg_ice_inc_bw      0.0    
  cbcl_scr_syn_attention_r          0.0    
  reshist_addr1_seg_ice_income      0.0    
  devhx_18_p                        0.0    
  inr                               0.0    
  interview_age                     0.0    
  reshist_addr1_coi_se_mhe          0.0    
  reshist_addr1_coi_he_vacancy      0.0    
  reshist_addr1_coi_se_povrate      0.0    
  birth_weight                      0.0    
  reshist_addr1_adi_perc            0.0    
  reshist_addr1_coi_se_public       0.0    
  upps_y_ss_positive_urgency        0.0    
  screentime1_p_hours               0.0    
  reshist_addr1_coi_ed_schpov       0.0    
  demo_prtnr_ed_v2                  0.0    
  demo_prnt_ed_v2                   0.0    
  reshist_addr1_coi_ed_math         0.0    
  reshist_addr1_coi_se_single       0.0    
  reshist_state_sexism_factor       0.0    
> table_util_imp <- tibble::rownames_to_column(table_util_imp, "Characteristic")[,c(1:5)]
> table_util_imp
                 Characteristic                  X0                  X1      p
1                             n                 860                 505       
2  reshist_addr1_seg_ice_inc_bw         0.02 (0.23)         0.11 (0.22) <0.001
3      cbcl_scr_syn_attention_r         3.70 (3.99)         2.41 (3.11) <0.001
4  reshist_addr1_seg_ice_income        -0.07 (0.27)         0.03 (0.26) <0.001
5                    devhx_18_p         5.43 (7.30)         7.16 (7.73) <0.001
6                           inr         1.01 (0.59)         1.19 (0.56) <0.001
7                 interview_age       118.40 (7.41)       119.53 (7.74)  0.007
8      reshist_addr1_coi_se_mhe 50375.87 (22433.40) 57552.29 (23247.70) <0.001
9  reshist_addr1_coi_he_vacancy         9.47 (7.41)         7.52 (6.48) <0.001
10 reshist_addr1_coi_se_povrate       20.83 (12.93)       16.79 (11.43) <0.001
11                 birth_weight         6.85 (1.45)         7.12 (1.43)  0.001
12       reshist_addr1_adi_perc       57.86 (27.55)       49.81 (25.98) <0.001
13  reshist_addr1_coi_se_public       21.51 (14.58)       16.52 (12.46) <0.001
14   upps_y_ss_positive_urgency         8.58 (3.01)         7.96 (3.04) <0.001
15          screentime1_p_hours         3.15 (2.80)         2.70 (2.31)  0.003
16  reshist_addr1_coi_ed_schpov       67.59 (24.25)       60.21 (25.58) <0.001
17             demo_prtnr_ed_v2        13.17 (2.47)        13.78 (2.55) <0.001
18              demo_prnt_ed_v2        13.55 (2.04)        14.08 (2.14) <0.001
19    reshist_addr1_coi_ed_math      187.98 (65.90)      209.08 (68.47) <0.001
20  reshist_addr1_coi_se_single       45.97 (21.60)       39.63 (20.08) <0.001
21  reshist_state_sexism_factor         0.00 (0.85)         0.05 (0.92)  0.292
   test
1      
2      
3      
4      
5      
6      
7      
8      
9      
10     
11     
12     
13     
14     
15     
16     
17     
18     
19     
20     
21     
> 
> names(table_util_imp) <- c("Variable", "Poverty_Low_Cog", "Poverty_High_Cog","p_value","prop_missing")
> 
> table_util_imp_label <- merge(x=table_util_imp, y=dict, by="Variable",all.x=T) %>%
+   dplyr::select(Label,Variable,Poverty_Low_Cog,Poverty_High_Cog,p_value)
> 
> table_util_imp_label_gain <- merge(x=table_util_imp_label, y=imp, all.x=T, by="Variable")
> table_util_imp_label_gain
                       Variable
1                  birth_weight
2      cbcl_scr_syn_attention_r
3               demo_prnt_ed_v2
4              demo_prtnr_ed_v2
5                    devhx_18_p
6                           inr
7                 interview_age
8                             n
9        reshist_addr1_adi_perc
10    reshist_addr1_coi_ed_math
11  reshist_addr1_coi_ed_schpov
12 reshist_addr1_coi_he_vacancy
13     reshist_addr1_coi_se_mhe
14 reshist_addr1_coi_se_povrate
15  reshist_addr1_coi_se_public
16  reshist_addr1_coi_se_single
17 reshist_addr1_seg_ice_inc_bw
18 reshist_addr1_seg_ice_income
19  reshist_state_sexism_factor
20          screentime1_p_hours
21   upps_y_ss_positive_urgency
                                                                                                                                                                                                                                                                                                                                                 Label
1                                                                                                                                                                                                                                                                                                  Developmental history quesitonnaire: birth weight: 
2                                                                                                                                                                                                                                               Child dimensional psychopathology - CBCL -  parent-reported: Attention CBCL Syndrome Scale (raw score)
3                                                                                                                                                                                                                     Parental ed - primary: What is the highest grade or level of school you have completed or the highest degree you have received? 
4                                                                                                                                                                           Parental ed - secondary: What is the highest grade or level of school your partner completed or highest degree they received? (imputed with parent's education if missing)
5                                                                                                                                                                                                                                                                                   Developmental history questionnaire: nuumber of months breastfed: 
6                                                                                                                                                                                                                                                                                                                                                  INR
7                                                                                                                                                                                                                                                                                                                                                 <NA>
8                                                                                                                                                                                                                                                                                                                                                    n
9                                                                                                                                                                                                                                                 Neightbohood quality: Area Deprivation Index (national percentiles, higher means higher deprivation)
10                                                                                                                                                                                                                           Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Education Domain: Third grade math proficiency
11                                                                                                                                                                                                                                         Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Education Domain: School poverty
12                                                                                                                                                                                                                      Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Health and Environment Domain: Housing vacancy rate
13                                                                                                                                                                                                                      Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Social and Economic Domain: Median household income
14                                                                                                                                                                                                                                 Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Social and Economic Domain: Poverty rate
15                                                                                                                                                                                                                       Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Social and Economic Domain: Public assistance rate
16                                                                                                                                                                                                                     Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Social and Economic Domain: Single-headed households
17                              Neighborhood: residential segregation - Index of Concentrations at the Extremes: Residential history derived- Index of Concentration at the Extremes(Income+ BW), (non-Hispanic white Households income >= $100k) - (non-Hispanic Black Households income < $25k)/total population, ACS2014-2018; census tract (addr1)
18                                                                       Neighborhood: residential segregation - Index of Concentrations at the Extremes: Residential history derived- Index of Concentration at the Extremes (income), (Households income >= $100k) - (Households income < $25k)/total population, ACS2014-2018; census tract (addr1)
19                                                                                                                                                                                                                                               Laws and biases: Gender bias: State level indicators of sexism from survey and implicit bias measures
20 Screen time: On a typical WEEKDAY, how much TIME does your child spend on a computer, cellphone, tablet, or other electronic device? (Please do NOT include time spent on school related work, but do include watching TV, shows or videos, texting or chatting, playing games, or visiting social networking sites (Facebook, Twitter, Instagram).
21                                                                                                                                         Temperament/Personality: UPPS-P (Urgency, Premeditation, Perseverance, Sensation Seeking, Positive Urgency, Impulsive behavior scale): Positive Urgency: tendency to act impulsively due to positive affect
       Poverty_Low_Cog    Poverty_High_Cog p_value        Gain       Cover
1          6.85 (1.45)         7.12 (1.43)   0.001 0.020113481 0.066313803
2          3.70 (3.99)         2.41 (3.11)  <0.001 0.195369411 0.199618152
3         13.55 (2.04)        14.08 (2.14)  <0.001 0.004410570 0.016078317
4         13.17 (2.47)        13.78 (2.55)  <0.001 0.005005988 0.016659434
5          5.43 (7.30)         7.16 (7.73)  <0.001 0.116656204 0.092135429
6          1.01 (0.59)         1.19 (0.56)  <0.001 0.086162874 0.092840648
7        118.40 (7.41)       119.53 (7.74)   0.007 0.053948336 0.111881435
8                  860                 505                  NA          NA
9        57.86 (27.55)       49.81 (25.98)  <0.001 0.009432054 0.013176006
10      187.98 (65.90)      209.08 (68.47)  <0.001 0.004018350 0.008666561
11       67.59 (24.25)       60.21 (25.58)  <0.001 0.005698952 0.014363880
12         9.47 (7.41)         7.52 (6.48)  <0.001 0.025296232 0.054104452
13 50375.87 (22433.40) 57552.29 (23247.70)  <0.001 0.035149095 0.030188442
14       20.83 (12.93)       16.79 (11.43)  <0.001 0.021259487 0.049125989
15       21.51 (14.58)       16.52 (12.46)  <0.001 0.009246651 0.016796022
16       45.97 (21.60)       39.63 (20.08)  <0.001 0.003844429 0.011442078
17         0.02 (0.23)         0.11 (0.22)  <0.001 0.201796294 0.071614283
18        -0.07 (0.27)         0.03 (0.26)  <0.001 0.181184545 0.044998458
19         0.00 (0.85)         0.05 (0.92)   0.292 0.001564178 0.009692530
20         3.15 (2.80)         2.70 (2.31)   0.003 0.007037622 0.024813517
21         8.58 (3.01)         7.96 (3.04)  <0.001 0.007103969 0.029245168
     Frequency
1  0.068493151
2  0.226027397
3  0.013698630
4  0.020547945
5  0.095890411
6  0.068493151
7  0.123287671
8           NA
9  0.020547945
10 0.006849315
11 0.013698630
12 0.047945205
13 0.020547945
14 0.034246575
15 0.013698630
16 0.013698630
17 0.054794521
18 0.034246575
19 0.006849315
20 0.047945205
21 0.020547945
> 
> write.csv(table_util_imp_label_gain,"/Users/Kat/Library/CloudStorage/OneDrive-HarvardUniversity/abcd_study_with_kat/results/INR_tert_fluid_cvXgb_complete_cases_table_util_imp_label_gain.csv")
> 
> 
> #-- Run a logistic regression with the top 20 important predictors selected by xgboost
> glm_cvxgboost = glm(data=d_flpov, formula(paste("resilience ~ ",paste(table_util_imp$Variable[2:21], collapse ="+"), collapse = " ")), family="binomial")
> 
> summary(glm_cvxgboost)

Call:
glm(formula = formula(paste("resilience ~ ", paste(table_util_imp$Variable[2:21], 
    collapse = "+"), collapse = " ")), family = "binomial", data = d_flpov)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.6290  -0.9624  -0.6870   1.1712   2.4962  

Coefficients:
                               Estimate Std. Error z value Pr(>|z|)    
(Intercept)                  -5.043e+00  1.381e+00  -3.653  0.00026 ***
reshist_addr1_seg_ice_inc_bw  1.081e+00  6.838e-01   1.581  0.11399    
cbcl_scr_syn_attention_r     -9.669e-02  1.795e-02  -5.385 7.24e-08 ***
reshist_addr1_seg_ice_income  5.236e-01  9.178e-01   0.571  0.56832    
devhx_18_p                    1.086e-02  8.227e-03   1.321  0.18666    
inr                           2.293e-01  1.142e-01   2.008  0.04468 *  
interview_age                 2.335e-02  7.901e-03   2.956  0.00312 ** 
reshist_addr1_coi_se_mhe     -7.761e-06  8.220e-06  -0.944  0.34506    
reshist_addr1_coi_he_vacancy -1.009e-02  1.273e-02  -0.793  0.42796    
reshist_addr1_coi_se_povrate -4.611e-04  1.034e-02  -0.045  0.96445    
birth_weight                  1.130e-01  4.193e-02   2.695  0.00704 ** 
reshist_addr1_adi_perc        1.365e-03  4.162e-03   0.328  0.74292    
reshist_addr1_coi_se_public  -1.135e-02  9.035e-03  -1.256  0.20906    
upps_y_ss_positive_urgency   -2.915e-02  2.016e-02  -1.446  0.14819    
screentime1_p_hours          -3.235e-02  2.524e-02  -1.282  0.20001    
reshist_addr1_coi_ed_schpov   2.499e-03  4.065e-03   0.615  0.53876    
demo_prtnr_ed_v2              1.930e-02  2.904e-02   0.664  0.50647    
demo_prnt_ed_v2               5.136e-02  3.510e-02   1.463  0.14342    
reshist_addr1_coi_ed_math     1.874e-03  1.343e-03   1.395  0.16308    
reshist_addr1_coi_se_single   7.855e-03  5.409e-03   1.452  0.14648    
reshist_state_sexism_factor   3.878e-02  7.679e-02   0.505  0.61354    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1798.9  on 1364  degrees of freedom
Residual deviance: 1666.7  on 1344  degrees of freedom
AIC: 1708.7

Number of Fisher Scoring iterations: 4

> 
> pred <- predict(glm_cvxgboost, newdata=d_flpov, type="response")
> roc_test <- roc(labels, pred, algorithm = 2) 
Setting levels: control = 0, case = 1
Setting direction: controls < cases
> roc_test$auc
Area under the curve: 0.6814
> 
> #------------------------------------------------#
> #-- cross-validated XGBoost in 1x imputed data --#
> 
> d <- complete(d_imp)
> 
> d_pov_highflcog <- d %>% filter(pov3_highflcog==1) %>% 
+   mutate(profile="pov3_highflcog",
+          resilience=1)
> d_pov_lowflcog <- d %>% filter(pov3_lowflcog==1) %>% 
+   mutate(profile="pov3_lowflcog",
+          resilience=0)
> 
> d_flpov <- rbind(d_pov_highflcog,d_pov_lowflcog)
> 
> set.seed(123)
> labels <- d_flpov$resilience
> 
> names(d_flpov)
  [1] "src_subject_id"                 "inr"                           
  [3] "nihtbx_fluidcomp_agecorrected"  "nihtbx_cryst_agecorrected"     
  [5] "nihtbx_totalcomp_agecorrected"  "fluid_s"                       
  [7] "cryst_s"                        "totcomp_s"                     
  [9] "inr_quart"                      "inr_tert"                      
 [11] "pov_highflcog"                  "pov_lowflcog"                  
 [13] "welloff_highflcog"              "welloff_lowflcog"              
 [15] "pov_highcrcog"                  "pov_lowcrcog"                  
 [17] "welloff_highcrcog"              "welloff_lowcrcog"              
 [19] "pov3_highflcog"                 "pov3_lowflcog"                 
 [21] "welloff3_highflcog"             "welloff3_lowflcog"             
 [23] "pov3_highcrcog"                 "pov3_lowcrcog"                 
 [25] "welloff3_highcrcog"             "welloff3_lowcrcog"             
 [27] "rel_family_id"                  "interview_age"                 
 [29] "srpf_y_ss_ses"                  "nsc_p_ss_mean_3_items"         
 [31] "fes_p_ss_fc"                    "fes_y_ss_fc"                   
 [33] "crpbi_y_ss_parent"              "crpbi_y_ss_caregiver"          
 [35] "pmq_y_ss_mean"                  "psb_p_ss_mean"                 
 [37] "psb_y_ss_mean"                  "reshist_addr1_coi_ed_attain"   
 [39] "reshist_addr1_coi_ed_apenr"     "reshist_addr1_coi_ed_college"  
 [41] "reshist_addr1_coi_ed_prxece"    "reshist_addr1_coi_ed_ecenrol"  
 [43] "reshist_addr1_coi_ed_hsgrad"    "reshist_addr1_coi_ed_prxhqece" 
 [45] "reshist_addr1_coi_ed_schpov"    "reshist_addr1_coi_ed_teachxp"  
 [47] "reshist_addr1_coi_ed_math"      "reshist_addr1_coi_ed_reading"  
 [49] "reshist_addr1_coi_he_green"     "reshist_addr1_coi_he_food"     
 [51] "reshist_addr1_coi_he_pm25"      "reshist_addr1_coi_he_heat"     
 [53] "reshist_addr1_coi_he_suprfnd"   "reshist_addr1_coi_he_hlthins"  
 [55] "reshist_addr1_coi_he_vacancy"   "reshist_addr1_coi_he_rsei"     
 [57] "reshist_addr1_coi_he_ozone"     "reshist_addr1_coi_he_walk"     
 [59] "reshist_addr1_coi_se_jobprox"   "reshist_addr1_coi_se_emprat"   
 [61] "reshist_addr1_coi_se_occ"       "reshist_addr1_coi_se_home"     
 [63] "reshist_addr1_coi_se_mhe"       "reshist_addr1_coi_se_povrate"  
 [65] "reshist_addr1_coi_se_public"    "reshist_addr1_coi_se_single"   
 [67] "reshist_addr1_adi_perc"         "reshist_addr1_popdensity"      
 [69] "reshist_addr1_urban_area"       "reshist_addr1_walkindex"       
 [71] "reshist_addr1_traffic_count"    "reshist_addr1_proxrd"          
 [73] "reshist_addr1_svi_tot_20142018" "reshist_addr1_p1vlnt"          
 [75] "reshist_addr1_leadrisk"         "reshist_addr1_urbsat_ntl"      
 [77] "reshist_addr1_seg_diss_nww_m"   "reshist_addr1_seg_inter_nww_m" 
 [79] "reshist_addr1_seg_ice_income"   "reshist_addr1_seg_ice_inc_bw"  
 [81] "reshist_addr1_seg_entropy_t"    "reshist_state_racism_factor"   
 [83] "reshist_state_so_factor"        "reshist_state_sexism_factor"   
 [85] "reshist_addr1_ACAexpand"        "demo_mar_livingwith"           
 [87] "demo_prnt_ed_v2"                "demo_prtnr_ed_v2"              
 [89] "demo_fam_exp1_v2"               "demo_fam_exp2_v2"              
 [91] "demo_fam_exp3_v2"               "demo_fam_exp4_v2"              
 [93] "demo_fam_exp5_v2"               "demo_fam_exp6_v2"              
 [95] "demo_fam_exp7_v2"               "ksads_ptsd_raw_754_p"          
 [97] "ksads_ptsd_raw_755_p"           "ksads_ptsd_raw_756_p"          
 [99] "ksads_ptsd_raw_757_p"           "ksads_ptsd_raw_758_p"          
[101] "ksads_ptsd_raw_759_p"           "ksads_ptsd_raw_760_p"          
[103] "ksads_ptsd_raw_761_p"           "ksads_ptsd_raw_762_p"          
[105] "ksads_ptsd_raw_763_p"           "ksads_ptsd_raw_764_p"          
[107] "ksads_ptsd_raw_765_p"           "ksads_ptsd_raw_766_p"          
[109] "ksads_ptsd_raw_767_p"           "ksads_ptsd_raw_768_p"          
[111] "ksads_ptsd_raw_769_p"           "ksads_ptsd_raw_770_p"          
[113] "ksads_ptsd_accident"            "ksads_ptsd_wit_viol"           
[115] "ksads_ptsd_thr_viol"            "ksads_ptsd_phys_abuse"         
[117] "ksads_ptsd_sexual_abuse"        "kbi_p_c_bully"                 
[119] "famhx_ss_fath_prob_alc_p"       "famhx_ss_moth_prob_alc_p"      
[121] "famhx_ss_moth_prob_dg_p"        "famhx_ss_fath_prob_dg_p"       
[123] "famhx_ss_fath_prob_prf_p"       "famhx_ss_moth_prob_prf_p"      
[125] "famhx_ss_moth_prob_hspd_p"      "famhx_ss_fath_prob_hspd_p"     
[127] "asr_q06_p"                      "asr_q90_p"                     
[129] "asr_q126_p"                     "asr_scr_anxdep_t"              
[131] "asr_scr_withdrawn_t"            "asr_scr_somatic_t"             
[133] "asr_scr_thought_t"              "asr_scr_attention_t"           
[135] "asr_scr_aggressive_t"           "asr_scr_rulebreak_t"           
[137] "asr_scr_intrusive_t"            "pubertal_sex_p"                
[139] "pds_p_ss_cat"                   "birth_weight"                  
[141] "devhx_3_p"                      "devhx_4_p"                     
[143] "devhx_6_p"                      "preg_any_subst"                
[145] "devhx_10"                       "preg_caffeine"                 
[147] "birth_complications"            "devhx_13_3_p"                  
[149] "devhx_18_p"                     "physical_activity1_y"          
[151] "physical_activity5_y"           "sai_p_activities___24"         
[153] "sai_p_perf_arts"                "sai_p_team_sports"             
[155] "sai_p_non_team_sports"          "sai_p_other"                   
[157] "sai_p_any"                      "sds_p_ss_dims"                 
[159] "sds_p_ss_sbd"                   "sds_p_ss_da"                   
[161] "sds_p_ss_swtd"                  "sds_p_ss_does"                 
[163] "sds_p_ss_shy"                   "sds_p_ss_total"                
[165] "screentime1_p_hours"            "screentime2_p_hours"           
[167] "bis_y_ss_bas_drive"             "bis_y_ss_bas_fs"               
[169] "bis_y_ss_bas_rr"                "bis_y_ss_bis_sum"              
[171] "upps_y_ss_positive_urgency"     "upps_y_ss_negative_urgency"    
[173] "upps_y_ss_lack_of_planning"     "upps_y_ss_lack_of_perseverance"
[175] "upps_y_ss_sensation_seeking"    "cbcl_scr_syn_anxdep_r"         
[177] "cbcl_scr_syn_withdep_r"         "cbcl_scr_syn_somatic_r"        
[179] "cbcl_scr_syn_social_r"          "cbcl_scr_syn_thought_r"        
[181] "cbcl_scr_syn_attention_r"       "cbcl_scr_syn_rulebreak_r"      
[183] "cbcl_scr_syn_aggressive_r"      "num_friends"                   
[185] "num_close_friends"              "parent_su_comm_risk"           
[187] "parent_subst_rules"             "parent_no_subst_rules"         
[189] "peer_deviance"                  "some_peer_deviance"            
[191] "profile"                        "resilience"                    
> new_tr <- as.matrix(d_flpov[,c(2,28:190)])
> 
> dtrain <- xgb.DMatrix(data = new_tr,label = labels) 
> 
> params <- list(booster = "gbtree", objective = "binary:logistic", 
+                eta=0.1, gamma=0.1, max_depth=2, 
+                min_child_weight=1, 
+                subsample=1, colsample_bytree=1)
> 
> xgbcv <- xgb.cv(params = params, data = dtrain, nrounds = 50, 
+                 nfold = 10,print_every_n = 10, 
+                 prediction=TRUE,
+                 maximize = F, eval="error")
[1]	train-logloss:0.680044+0.000320	test-logloss:0.680858+0.001370 
[11]	train-logloss:0.620794+0.001280	test-logloss:0.631001+0.007842 
[21]	train-logloss:0.600952+0.001311	test-logloss:0.618410+0.009783 
[31]	train-logloss:0.588480+0.001211	test-logloss:0.612516+0.010227 
[41]	train-logloss:0.578889+0.001187	test-logloss:0.608950+0.009908 
[50]	train-logloss:0.571307+0.001212	test-logloss:0.606735+0.009843 
> xgbpred <- xgbcv$pred
> 
> summary(xgbpred)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.08561 0.26728 0.33493 0.34430 0.41405 0.75945 
> hist(xgbpred)
> roc_test <- roc(labels, xgbpred, algorithm = 2) 
Setting levels: control = 0, case = 1
Setting direction: controls < cases
> roc_test$auc
Area under the curve: 0.6639
> 
> #-- Assess variable importance
> 
> xgb_util <- xgboost(data = new_tr, label = xgbpred, params = params, nrounds = 50, verbose=FALSE)
> importance_matrix_util <- xgb.importance(model = xgb_util)
> importance_matrix_util
                         Feature         Gain        Cover   Frequency
 1: reshist_addr1_seg_ice_income 0.2245903802 0.0536284295 0.033783784
 2:     cbcl_scr_syn_attention_r 0.1366160624 0.1506282662 0.182432432
 3:     reshist_addr1_coi_se_mhe 0.0926109310 0.0490596753 0.033783784
 4:                          inr 0.0670411666 0.0697501859 0.060810811
 5:                   devhx_18_p 0.0665132834 0.0786678583 0.067567568
 6: reshist_addr1_seg_ice_inc_bw 0.0567808411 0.0433109449 0.040540541
 7:                interview_age 0.0526669715 0.0964626232 0.087837838
 8: reshist_addr1_coi_he_vacancy 0.0460446876 0.0563584411 0.047297297
 9:             demo_prtnr_ed_v2 0.0388947202 0.0342365282 0.033783784
10:   upps_y_ss_positive_urgency 0.0380534884 0.0634495802 0.060810811
11:              demo_prnt_ed_v2 0.0375654240 0.0365948489 0.033783784
12:       reshist_addr1_adi_perc 0.0314550158 0.0161213856 0.013513514
13:                 birth_weight 0.0240209964 0.0587383427 0.054054054
14:          screentime2_p_hours 0.0189745797 0.0585918632 0.054054054
15:  reshist_addr1_coi_se_public 0.0187242781 0.0251949216 0.020270270
16:  reshist_addr1_coi_se_single 0.0155321121 0.0171488567 0.020270270
17: reshist_addr1_coi_se_povrate 0.0111003561 0.0183325434 0.040540541
18:          screentime1_p_hours 0.0096374822 0.0318860040 0.040540541
19: reshist_addr1_coi_ed_college 0.0076404086 0.0255529497 0.027027027
20:             asr_scr_anxdep_t 0.0020729382 0.0075729106 0.013513514
21:        cbcl_scr_syn_anxdep_r 0.0016114809 0.0042639537 0.006756757
22:            num_close_friends 0.0010167294 0.0025690799 0.006756757
23:    reshist_addr1_coi_ed_math 0.0004147113 0.0008958893 0.006756757
24:    reshist_addr1_coi_he_rsei 0.0002792679 0.0007323276 0.006756757
25:          asr_scr_withdrawn_t 0.0001416869 0.0002515904 0.006756757
                         Feature         Gain        Cover   Frequency
> ## Create table comparing distributions of top 20 important variables by any_util
> vars <- as.vector(unlist(importance_matrix_util[1:20,1]))
> imp <- data.frame(importance_matrix_util)
> names(imp) <- c("Variable","Gain","Cover","Frequency")
> 
> table_util_imp <- CreateTableOne(vars = vars,
+                                  strata = c("resilience"), 
+                                  includeNA = F, 
+                                  addOverall = F,
+                                  data = d_flpov)
> table_util_imp <- data.frame(print(table_util_imp, explain=F, missing=T, catDigits = 2, contDigits = 2))
                              Stratified by resilience
                               0                   1                   p     
  n                                2215                1158                  
  reshist_addr1_seg_ice_income    -0.07 (0.28)         0.02 (0.27)     <0.001
  cbcl_scr_syn_attention_r         3.80 (3.93)         2.78 (3.43)     <0.001
  reshist_addr1_coi_se_mhe     50344.73 (24425.06) 57434.54 (24786.40) <0.001
  inr                              0.95 (0.59)         1.12 (0.58)     <0.001
  devhx_18_p                       5.36 (7.52)         7.04 (8.22)     <0.001
  reshist_addr1_seg_ice_inc_bw     0.02 (0.25)         0.10 (0.22)     <0.001
  interview_age                  118.29 (7.33)       119.31 (7.65)     <0.001
  reshist_addr1_coi_he_vacancy     9.79 (7.85)         7.71 (6.30)     <0.001
  demo_prtnr_ed_v2                12.90 (2.55)        13.54 (2.70)     <0.001
  upps_y_ss_positive_urgency       8.73 (3.14)         8.03 (3.05)     <0.001
  demo_prnt_ed_v2                 13.31 (2.25)        13.92 (2.21)     <0.001
  reshist_addr1_adi_perc          58.23 (27.78)       50.02 (26.37)    <0.001
  birth_weight                     6.84 (1.43)         7.10 (1.45)     <0.001
  screentime2_p_hours              4.56 (3.21)         4.26 (2.78)      0.006
  reshist_addr1_coi_se_public     21.80 (15.66)       16.99 (12.67)    <0.001
  reshist_addr1_coi_se_single     46.35 (21.64)       40.10 (19.88)    <0.001
  reshist_addr1_coi_se_povrate    21.32 (13.92)       17.08 (11.85)    <0.001
  screentime1_p_hours              3.22 (2.93)         2.84 (2.52)     <0.001
  reshist_addr1_coi_ed_college    44.77 (10.91)       43.92 (10.62)     0.032
  asr_scr_anxdep_t                54.37 (6.88)        54.54 (6.78)      0.502
                              Stratified by resilience
                               test Missing
  n                                        
  reshist_addr1_seg_ice_income      0.0    
  cbcl_scr_syn_attention_r          0.0    
  reshist_addr1_coi_se_mhe          0.0    
  inr                               0.0    
  devhx_18_p                        0.0    
  reshist_addr1_seg_ice_inc_bw      0.0    
  interview_age                     0.0    
  reshist_addr1_coi_he_vacancy      0.0    
  demo_prtnr_ed_v2                  0.0    
  upps_y_ss_positive_urgency        0.0    
  demo_prnt_ed_v2                   0.0    
  reshist_addr1_adi_perc            0.0    
  birth_weight                      0.0    
  screentime2_p_hours               0.0    
  reshist_addr1_coi_se_public       0.0    
  reshist_addr1_coi_se_single       0.0    
  reshist_addr1_coi_se_povrate      0.0    
  screentime1_p_hours               0.0    
  reshist_addr1_coi_ed_college      0.0    
  asr_scr_anxdep_t                  0.0    
> table_util_imp <- tibble::rownames_to_column(table_util_imp, "Characteristic")[,c(1:5)]
> table_util_imp
                 Characteristic                  X0                  X1      p
1                             n                2215                1158       
2  reshist_addr1_seg_ice_income        -0.07 (0.28)         0.02 (0.27) <0.001
3      cbcl_scr_syn_attention_r         3.80 (3.93)         2.78 (3.43) <0.001
4      reshist_addr1_coi_se_mhe 50344.73 (24425.06) 57434.54 (24786.40) <0.001
5                           inr         0.95 (0.59)         1.12 (0.58) <0.001
6                    devhx_18_p         5.36 (7.52)         7.04 (8.22) <0.001
7  reshist_addr1_seg_ice_inc_bw         0.02 (0.25)         0.10 (0.22) <0.001
8                 interview_age       118.29 (7.33)       119.31 (7.65) <0.001
9  reshist_addr1_coi_he_vacancy         9.79 (7.85)         7.71 (6.30) <0.001
10             demo_prtnr_ed_v2        12.90 (2.55)        13.54 (2.70) <0.001
11   upps_y_ss_positive_urgency         8.73 (3.14)         8.03 (3.05) <0.001
12              demo_prnt_ed_v2        13.31 (2.25)        13.92 (2.21) <0.001
13       reshist_addr1_adi_perc       58.23 (27.78)       50.02 (26.37) <0.001
14                 birth_weight         6.84 (1.43)         7.10 (1.45) <0.001
15          screentime2_p_hours         4.56 (3.21)         4.26 (2.78)  0.006
16  reshist_addr1_coi_se_public       21.80 (15.66)       16.99 (12.67) <0.001
17  reshist_addr1_coi_se_single       46.35 (21.64)       40.10 (19.88) <0.001
18 reshist_addr1_coi_se_povrate       21.32 (13.92)       17.08 (11.85) <0.001
19          screentime1_p_hours         3.22 (2.93)         2.84 (2.52) <0.001
20 reshist_addr1_coi_ed_college       44.77 (10.91)       43.92 (10.62)  0.032
21             asr_scr_anxdep_t        54.37 (6.88)        54.54 (6.78)  0.502
   test
1      
2      
3      
4      
5      
6      
7      
8      
9      
10     
11     
12     
13     
14     
15     
16     
17     
18     
19     
20     
21     
> 
> names(table_util_imp) <- c("Variable", "Poverty_Low_Cog", "Poverty_High_Cog","p_value","prop_missing")
> 
> table_util_imp_label <- merge(x=table_util_imp, y=dict, by="Variable",all.x=T) %>%
+   dplyr::select(Label,Variable,Poverty_Low_Cog,Poverty_High_Cog,p_value,prop_missing,Order,Order2)
> 
> table_util_imp_label_gain <- merge(x=table_util_imp_label, y=imp, all.x=T, by="Variable")
> table_util_imp_label_gain
                       Variable
1              asr_scr_anxdep_t
2                  birth_weight
3      cbcl_scr_syn_attention_r
4               demo_prnt_ed_v2
5              demo_prtnr_ed_v2
6                    devhx_18_p
7                           inr
8                 interview_age
9                             n
10       reshist_addr1_adi_perc
11 reshist_addr1_coi_ed_college
12 reshist_addr1_coi_he_vacancy
13     reshist_addr1_coi_se_mhe
14 reshist_addr1_coi_se_povrate
15  reshist_addr1_coi_se_public
16  reshist_addr1_coi_se_single
17 reshist_addr1_seg_ice_inc_bw
18 reshist_addr1_seg_ice_income
19          screentime1_p_hours
20          screentime2_p_hours
21   upps_y_ss_positive_urgency
                                                                                                                                                                                                                                                                                                                                                     Label
1                                                                                                                                                                                                                                                                   Parental psychopathology - adult self-report (parent) ASEBA: Anxious/depressed t-score
2                                                                                                                                                                                                                                                                                                      Developmental history quesitonnaire: birth weight: 
3                                                                                                                                                                                                                                                   Child dimensional psychopathology - CBCL -  parent-reported: Attention CBCL Syndrome Scale (raw score)
4                                                                                                                                                                                                                         Parental ed - primary: What is the highest grade or level of school you have completed or the highest degree you have received? 
5                                                                                                                                                                               Parental ed - secondary: What is the highest grade or level of school your partner completed or highest degree they received? (imputed with parent's education if missing)
6                                                                                                                                                                                                                                                                                       Developmental history questionnaire: nuumber of months breastfed: 
7                                                                                                                                                                                                                                                                                                                                                      INR
8                                                                                                                                                                                                                                                                                                                                                     <NA>
9                                                                                                                                                                                                                                                                                                                                                        n
10                                                                                                                                                                                                                                                    Neightbohood quality: Area Deprivation Index (national percentiles, higher means higher deprivation)
11                                                                                                                                                                                                                  Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Education Domain: College enrollment in nearby institutions
12                                                                                                                                                                                                                          Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Health and Environment Domain: Housing vacancy rate
13                                                                                                                                                                                                                          Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Social and Economic Domain: Median household income
14                                                                                                                                                                                                                                     Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Social and Economic Domain: Poverty rate
15                                                                                                                                                                                                                           Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Social and Economic Domain: Public assistance rate
16                                                                                                                                                                                                                         Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Social and Economic Domain: Single-headed households
17                                  Neighborhood: residential segregation - Index of Concentrations at the Extremes: Residential history derived- Index of Concentration at the Extremes(Income+ BW), (non-Hispanic white Households income >= $100k) - (non-Hispanic Black Households income < $25k)/total population, ACS2014-2018; census tract (addr1)
18                                                                           Neighborhood: residential segregation - Index of Concentrations at the Extremes: Residential history derived- Index of Concentration at the Extremes (income), (Households income >= $100k) - (Households income < $25k)/total population, ACS2014-2018; census tract (addr1)
19     Screen time: On a typical WEEKDAY, how much TIME does your child spend on a computer, cellphone, tablet, or other electronic device? (Please do NOT include time spent on school related work, but do include watching TV, shows or videos, texting or chatting, playing games, or visiting social networking sites (Facebook, Twitter, Instagram).
20 Screen time: On a typical WEEKEND DAY, how much TIME does your child spend on a computer, cellphone, tablet, or other electronic device? (Please do NOT include time spent on school related work, but do include watching TV, shows or videos, texting or chatting, playing games, or visiting social networking sites (Facebook, Twitter, Instagram).
21                                                                                                                                             Temperament/Personality: UPPS-P (Urgency, Premeditation, Perseverance, Sensation Seeking, Positive Urgency, Impulsive behavior scale): Positive Urgency: tendency to act impulsively due to positive affect
       Poverty_Low_Cog    Poverty_High_Cog p_value prop_missing Order Order2
1         54.37 (6.88)        54.54 (6.78)   0.502                  3     39
2          6.84 (1.43)         7.10 (1.45)  <0.001                  2      2
3          3.80 (3.93)         2.78 (3.43)  <0.001                  3     52
4         13.31 (2.25)        13.92 (2.21)  <0.001                  1      1
5         12.90 (2.55)        13.54 (2.70)  <0.001                  1      2
6          5.36 (7.52)         7.04 (8.22)  <0.001                  2     16
7          0.95 (0.59)         1.12 (0.58)  <0.001                  0      1
8        118.29 (7.33)       119.31 (7.65)  <0.001                 NA     NA
9                 2215                1158                          0      0
10       58.23 (27.78)       50.02 (26.37)  <0.001                  7      1
11       44.77 (10.91)       43.92 (10.62)   0.032                  7      7
12         9.79 (7.85)         7.71 (6.30)  <0.001                  7     22
13 50344.73 (24425.06) 57434.54 (24786.40)  <0.001                  7     30
14       21.32 (13.92)       17.08 (11.85)  <0.001                  7     31
15       21.80 (15.66)       16.99 (12.67)  <0.001                  7     32
16       46.35 (21.64)       40.10 (19.88)  <0.001                  7     33
17         0.02 (0.25)         0.10 (0.22)  <0.001                  7     52
18        -0.07 (0.28)         0.02 (0.27)  <0.001                  7     51
19         3.22 (2.93)         2.84 (2.52)  <0.001                  4      1
20         4.56 (3.21)         4.26 (2.78)   0.006                  4      2
21         8.73 (3.14)         8.03 (3.05)  <0.001                  3     59
          Gain       Cover  Frequency
1  0.002072938 0.007572911 0.01351351
2  0.024020996 0.058738343 0.05405405
3  0.136616062 0.150628266 0.18243243
4  0.037565424 0.036594849 0.03378378
5  0.038894720 0.034236528 0.03378378
6  0.066513283 0.078667858 0.06756757
7  0.067041167 0.069750186 0.06081081
8  0.052666971 0.096462623 0.08783784
9           NA          NA         NA
10 0.031455016 0.016121386 0.01351351
11 0.007640409 0.025552950 0.02702703
12 0.046044688 0.056358441 0.04729730
13 0.092610931 0.049059675 0.03378378
14 0.011100356 0.018332543 0.04054054
15 0.018724278 0.025194922 0.02027027
16 0.015532112 0.017148857 0.02027027
17 0.056780841 0.043310945 0.04054054
18 0.224590380 0.053628429 0.03378378
19 0.009637482 0.031886004 0.04054054
20 0.018974580 0.058591863 0.05405405
21 0.038053488 0.063449580 0.06081081
> 
> write.csv(table_util_imp_label_gain,"/Users/Kat/Library/CloudStorage/OneDrive-HarvardUniversity/abcd_study_with_kat/results/INR_tert_fluid_cvXgb_imputed1x_table_util_imp_label_gain.csv")
> 
> 
> #-- Run a logistic regression with the top 20 important predictors selected by xgboost
> glm_cvxgboost = glm(data=d_flpov, formula(paste("resilience ~ ",paste(table_util_imp$Variable[2:21], collapse ="+"), collapse = " ")), family="binomial")
> 
> summary(glm_cvxgboost)

Call:
glm(formula = formula(paste("resilience ~ ", paste(table_util_imp$Variable[2:21], 
    collapse = "+"), collapse = " ")), family = "binomial", data = d_flpov)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.6412  -0.9259  -0.6952   1.2044   2.5030  

Coefficients:
                               Estimate Std. Error z value Pr(>|z|)    
(Intercept)                  -4.660e+00  8.451e-01  -5.513 3.52e-08 ***
reshist_addr1_seg_ice_income  3.400e-01  5.416e-01   0.628 0.530136    
cbcl_scr_syn_attention_r     -8.122e-02  1.156e-02  -7.029 2.09e-12 ***
reshist_addr1_coi_se_mhe     -3.766e-06  4.192e-06  -0.898 0.368987    
inr                           2.039e-01  7.092e-02   2.875 0.004035 ** 
devhx_18_p                    1.032e-02  4.969e-03   2.076 0.037886 *  
reshist_addr1_seg_ice_inc_bw  2.487e-01  3.999e-01   0.622 0.533954    
interview_age                 1.895e-02  5.093e-03   3.721 0.000198 ***
reshist_addr1_coi_he_vacancy -1.655e-02  7.453e-03  -2.220 0.026388 *  
demo_prtnr_ed_v2              2.534e-02  1.900e-02   1.334 0.182266    
upps_y_ss_positive_urgency   -4.534e-02  1.250e-02  -3.627 0.000287 ***
demo_prnt_ed_v2               5.668e-02  2.268e-02   2.499 0.012451 *  
reshist_addr1_adi_perc       -2.094e-03  2.531e-03  -0.827 0.408140    
birth_weight                  1.153e-01  2.693e-02   4.282 1.85e-05 ***
screentime2_p_hours           2.285e-03  1.554e-02   0.147 0.883137    
reshist_addr1_coi_se_public  -4.045e-03  5.515e-03  -0.733 0.463332    
reshist_addr1_coi_se_single   3.728e-03  3.338e-03   1.117 0.263976    
reshist_addr1_coi_se_povrate -7.185e-03  6.158e-03  -1.167 0.243291    
screentime1_p_hours          -2.784e-02  1.717e-02  -1.622 0.104825    
reshist_addr1_coi_ed_college -5.482e-03  3.768e-03  -1.455 0.145766    
asr_scr_anxdep_t              1.914e-02  6.011e-03   3.184 0.001451 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 4339.1  on 3372  degrees of freedom
Residual deviance: 4058.6  on 3352  degrees of freedom
AIC: 4100.6

Number of Fisher Scoring iterations: 4

> 
> pred <- predict(glm_cvxgboost, newdata=d_flpov, type="response")
> roc_test <- roc(labels, pred, algorithm = 2) 
Setting levels: control = 0, case = 1
Setting direction: controls < cases
> roc_test$auc
Area under the curve: 0.6707
> 
> 
> #------------------#
> #-- SUPERLEARNER --#
> ######################################################################################
> # glmnet
> ######################################################################################
> # Create glmnet wrappers for different alphas (0=ridge, 5=elastic, 1=lasso).
> # The default value for alpha in SL.glmnet is 1
> #
> # Ridge will not be fed all variables, so we need to create a separate learner for it.
> ######################################################################################
> tune.glmnet <- list(alpha = seq(0.1, 0.9, by = 0.2))
> learners.glmnet <- create.Learner("SL.glmnet", tune = tune.glmnet, detailed_names = T, name_prefix = "SL.glmnet")
> learners.glmnet0 <- create.Learner("SL.glmnet", tune = list(alpha = 0), detailed_names = T, name_prefix = "SL.glmnet")
> learners.glmnet1 <- create.Learner("SL.glmnet", tune = list(alpha = 1), detailed_names = T, name_prefix = "SL.glmnet")
> 
> 
> ###################
> # ranger
> ###################
> # Set max.depth to 8, mtry to 9
> ###################
> learners.ranger_3 <- create.Learner("SL.ranger", params = list(max.depth = 3, num.trees = 1000), detailed_names = T, name_prefix = "SL.ranger_3")
> learners.ranger_4 <- create.Learner("SL.ranger", params = list(max.depth = 4, num.trees = 1000),  detailed_names = T, name_prefix = "SL.ranger_4")
> 
> #########
> # xgboost
> #########
> tune.xgb.1 <- list(ntrees = 200,
+                    max_depth = 4,
+                    shrinkage = 0.05,
+                    minobspernode = 5)
> learners.xgb.1 <- create.Learner("SL.xgboost", tune = tune.xgb.1, detailed_names = T, name_prefix = "SL.xgboost")
> 
> tune.xgb.2 <- list(ntrees = 400,
+                    max_depth = 4,
+                    shrinkage = 0.025,
+                    minobspernode = 5)
> learners.xgb.2 <- create.Learner("SL.xgboost", tune = tune.xgb.2, detailed_names = T, name_prefix = "SL.xgboost")
> 
> tune.xgb.3 <- list(ntrees = 1000,
+                    max_depth = 4,
+                    shrinkage = 0.01,
+                    minobspernode = 5)
> learners.xgb.3 <- create.Learner("SL.xgboost", tune = tune.xgb.3, detailed_names = T, name_prefix = "SL.xgboost")
> 
> 
> ##################################################
> # Define SL libraries and run sg
> ##################################################
> 
> SL.library = c(list(c('SL.glm','screen.corP'),
+                     c("SL.glmnet_0",'screen.corP'), c("SL.glmnet_1"), c("SL.glmnet_0.1",'screen.corP'), c("SL.glmnet_0.3",'screen.corP'), 
+                     c("SL.glmnet_0.5",'screen.corP'), c("SL.glmnet_0.7",'screen.corP'), c("SL.glmnet_0.9",'screen.corP'), 
+                     c("SL.ranger_3_1"), c("SL.ranger_4_1"), c(learners.xgb.1$names), 
+                     learners.xgb.2$names, 
+                     learners.xgb.3$names,
+                     c("SL.polymars",'screen.corP')))
> 
> SL.library
[[1]]
[1] "SL.glm"      "screen.corP"

[[2]]
[1] "SL.glmnet_0" "screen.corP"

[[3]]
[1] "SL.glmnet_1"

[[4]]
[1] "SL.glmnet_0.1" "screen.corP"  

[[5]]
[1] "SL.glmnet_0.3" "screen.corP"  

[[6]]
[1] "SL.glmnet_0.5" "screen.corP"  

[[7]]
[1] "SL.glmnet_0.7" "screen.corP"  

[[8]]
[1] "SL.glmnet_0.9" "screen.corP"  

[[9]]
[1] "SL.ranger_3_1"

[[10]]
[1] "SL.ranger_4_1"

[[11]]
[1] "SL.xgboost_200_4_0.05_5"

[[12]]
[1] "SL.xgboost_400_4_0.025_5"

[[13]]
[1] "SL.xgboost_1000_4_0.01_5"

[[14]]
[1] "SL.polymars" "screen.corP"

> 
> 
> 
> #-----------------------------------------#
> #-- SuperLearner in complete cases data --#
> 
> 
> d_pov_highcrcog <- dat_all_inr_complete %>% filter(pov3_highflcog==1) %>% 
+   mutate(profile="pov3_highflcog",
+          resilience=1)
> d_pov_lowcrcog <- dat_all_inr_complete %>% filter(pov3_lowflcog==1) %>% 
+   mutate(profile="pov3_lowflcog",
+          resilience=0)
> 
> d_flpov <- rbind(d_pov_highcrcog,d_pov_lowcrcog)
> 
> SL.library = c(list(c('SL.glm','screen.corP'),
+                     c("SL.glmnet_0",'screen.corP'), c("SL.glmnet_1"), c("SL.glmnet_0.1",'screen.corP'), c("SL.glmnet_0.3",'screen.corP'), 
+                     c("SL.glmnet_0.5",'screen.corP'), c("SL.glmnet_0.7",'screen.corP'), c("SL.glmnet_0.9",'screen.corP'), 
+                     c("SL.ranger_3_1"), c("SL.ranger_4_1"), c(learners.xgb.1$names), 
+                     learners.xgb.2$names, 
+                     learners.xgb.3$names,
+                     c("SL.polymars",'screen.corP')))
> 
> SL.library
[[1]]
[1] "SL.glm"      "screen.corP"

[[2]]
[1] "SL.glmnet_0" "screen.corP"

[[3]]
[1] "SL.glmnet_1"

[[4]]
[1] "SL.glmnet_0.1" "screen.corP"  

[[5]]
[1] "SL.glmnet_0.3" "screen.corP"  

[[6]]
[1] "SL.glmnet_0.5" "screen.corP"  

[[7]]
[1] "SL.glmnet_0.7" "screen.corP"  

[[8]]
[1] "SL.glmnet_0.9" "screen.corP"  

[[9]]
[1] "SL.ranger_3_1"

[[10]]
[1] "SL.ranger_4_1"

[[11]]
[1] "SL.xgboost_200_4_0.05_5"

[[12]]
[1] "SL.xgboost_400_4_0.025_5"

[[13]]
[1] "SL.xgboost_1000_4_0.01_5"

[[14]]
[1] "SL.polymars" "screen.corP"

> 
> set.seed(123)
> #-- Cross-validated SL
> options(mc.cores = 4)
> getOption("mc.cores")
[1] 4
> 
> labels <- d_flpov$resilience
> 
> X <- d_flpov[,c(2,28:190)]
> 
> set.seed(123)
> sl_fit <- CV.SuperLearner(Y = labels, X = X, family = binomial(),
+                           parallel = "multicore",
+                           id = d_flpov$rel_family_id,
+                           SL.library = SL.library)
Loading required namespace: polspline
Loading required namespace: polspline
Loading required namespace: polspline
Loading required namespace: polspline
Loading required namespace: ranger
Loading required namespace: ranger
Loading required namespace: ranger
Loading required namespace: ranger
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
step half ouch...
step half ouch...
warning - model size was reduced
step half ouch...
warning - model size was reduced
step half ouch...
step half ouch...
warning - model size was reduced
> sl_fit$coef
      SL.glm_screen.corP SL.glmnet_0_screen.corP SL.glmnet_1_All
 [1,]         0.00000000                       0       0.0000000
 [2,]         0.32530105                       0       0.0000000
 [3,]         0.06697458                       0       0.3058180
 [4,]         0.26075422                       0       0.0000000
 [5,]         0.19727041                       0       0.0000000
 [6,]         0.14093829                       0       0.0000000
 [7,]         0.16575519                       0       0.0000000
 [8,]         0.16932211                       0       0.1192253
 [9,]         0.16846434                       0       0.0000000
[10,]         0.37524209                       0       0.0000000
      SL.glmnet_0.1_screen.corP SL.glmnet_0.3_screen.corP
 [1,]                0.87473472                         0
 [2,]                0.17630005                         0
 [3,]                0.00000000                         0
 [4,]                0.00000000                         0
 [5,]                0.00000000                         0
 [6,]                0.50653288                         0
 [7,]                0.01236462                         0
 [8,]                0.00000000                         0
 [9,]                0.00000000                         0
[10,]                0.00000000                         0
      SL.glmnet_0.5_screen.corP SL.glmnet_0.7_screen.corP
 [1,]                 0.0000000                 0.0000000
 [2,]                 0.0000000                 0.0000000
 [3,]                 0.5448552                 0.0000000
 [4,]                 0.0000000                 0.0000000
 [5,]                 0.0000000                 0.3876339
 [6,]                 0.0000000                 0.0000000
 [7,]                 0.0000000                 0.0000000
 [8,]                 0.0000000                 0.5089111
 [9,]                 0.0000000                 0.0000000
[10,]                 0.0000000                 0.0000000
      SL.glmnet_0.9_screen.corP SL.ranger_3_1_All SL.ranger_4_1_All
 [1,]                 0.0000000          0.000000        0.08814649
 [2,]                 0.0000000          0.000000        0.00000000
 [3,]                 0.0000000          0.000000        0.00000000
 [4,]                 0.0000000          0.000000        0.22249785
 [5,]                 0.0000000          0.000000        0.17925722
 [6,]                 0.1114757          0.000000        0.04346283
 [7,]                 0.4242959          0.000000        0.33957157
 [8,]                 0.0000000          0.151307        0.00000000
 [9,]                 0.2831183          0.000000        0.19135760
[10,]                 0.0000000          0.000000        0.44270602
      SL.xgboost_200_4_0.05_5_All SL.xgboost_400_4_0.025_5_All
 [1,]                  0.01750047                   0.00000000
 [2,]                  0.00000000                   0.23102189
 [3,]                  0.06146572                   0.02088647
 [4,]                  0.27916305                   0.00000000
 [5,]                  0.00000000                   0.00000000
 [6,]                  0.00000000                   0.00000000
 [7,]                  0.00000000                   0.00000000
 [8,]                  0.00000000                   0.05123451
 [9,]                  0.00000000                   0.00000000
[10,]                  0.15800810                   0.00000000
      SL.xgboost_1000_4_0.01_5_All SL.polymars_screen.corP
 [1,]                   0.00000000              0.01961832
 [2,]                   0.00000000              0.26737700
 [3,]                   0.00000000              0.00000000
 [4,]                   0.00000000              0.23758488
 [5,]                   0.00000000              0.23583849
 [6,]                   0.11471721              0.08287309
 [7,]                   0.05801272              0.00000000
 [8,]                   0.00000000              0.00000000
 [9,]                   0.00000000              0.35705973
[10,]                   0.00000000              0.02404380
> 
> pred = sl_fit$SL.predict
> pred_rocr = ROCR::prediction(pred, labels)
> auc = ROCR::performance(pred_rocr, measure = "auc", x.measure = "cutoff")@y.values[[1]]
> auc
[1] 0.6343541
> 
> 
> new_ts <- as.matrix(X)
> dim(new_ts)
[1] 1365  164
> length(pred)
[1] 1365
> 
> xgb_util <- xgboost(data = new_ts, label = pred, nrounds = 200, verbose=FALSE,params=params)
> importance_matrix <- xgb.importance(model = xgb_util)
> importance_matrix
                           Feature         Gain        Cover   Frequency
 1:   reshist_addr1_seg_ice_inc_bw 0.2491629419 0.0564673699 0.053412463
 2:       cbcl_scr_syn_attention_r 0.2480780013 0.1534177337 0.151335312
 3:                            inr 0.0711858603 0.0340430228 0.029673591
 4:   reshist_addr1_seg_ice_income 0.0533722171 0.0087843482 0.005934718
 5:    reshist_addr1_coi_se_public 0.0365983378 0.0218929100 0.026706231
 6:                  interview_age 0.0306045255 0.0903457674 0.077151335
 7:                   birth_weight 0.0287632941 0.0771939802 0.071216617
 8:                     devhx_18_p 0.0278248067 0.0267933233 0.023738872
 9:                demo_prnt_ed_v2 0.0248629482 0.0374180762 0.035608309
10:               demo_prtnr_ed_v2 0.0212508743 0.0115686281 0.011869436
11:    reshist_addr1_coi_ed_schpov 0.0170098936 0.0082195951 0.008902077
12:                sai_p_perf_arts 0.0163657655 0.0278617897 0.029673591
13:     upps_y_ss_positive_urgency 0.0154395840 0.0441214177 0.035608309
14:            demo_mar_livingwith 0.0151152378 0.0173148243 0.014836795
15:                   pds_p_ss_cat 0.0146522873 0.0454967469 0.041543027
16:           ksads_ptsd_raw_769_p 0.0142281293 0.0511701879 0.041543027
17:    reshist_addr1_coi_se_single 0.0133724332 0.0062100003 0.005934718
18:      reshist_addr1_coi_ed_math 0.0127895248 0.0150372328 0.017804154
19:         reshist_addr1_adi_perc 0.0123161769 0.0077511733 0.011869436
20:   reshist_addr1_coi_se_povrate 0.0121336111 0.0055690906 0.008902077
21:              sai_p_team_sports 0.0082215262 0.0259789994 0.020771513
22:            screentime1_p_hours 0.0077359030 0.0227823229 0.032640950
23:   reshist_addr1_coi_he_vacancy 0.0062764517 0.0070391903 0.005934718
24:               demo_fam_exp4_v2 0.0054006379 0.0306729825 0.023738872
25:         reshist_addr1_leadrisk 0.0049212094 0.0035717278 0.005934718
26:           physical_activity1_y 0.0031908124 0.0221306136 0.023738872
27:           reshist_addr1_p1vlnt 0.0030382969 0.0195381725 0.017804154
28:      cbcl_scr_syn_aggressive_r 0.0029554083 0.0041655508 0.008902077
29:   reshist_addr1_coi_ed_college 0.0023755460 0.0054418278 0.017804154
30:      reshist_addr1_coi_he_food 0.0023101352 0.0099387054 0.008902077
31: upps_y_ss_lack_of_perseverance 0.0020600060 0.0182230050 0.017804154
32:      reshist_addr1_coi_he_heat 0.0017577948 0.0118824716 0.014836795
33:    reshist_addr1_coi_se_emprat 0.0016722132 0.0008545536 0.011869436
34:    reshist_addr1_coi_ed_attain 0.0015830596 0.0044936033 0.005934718
35:         cbcl_scr_syn_thought_r 0.0015730845 0.0051593129 0.008902077
36:       reshist_addr1_coi_se_mhe 0.0014925233 0.0032030073 0.005934718
37:   reshist_addr1_coi_he_hlthins 0.0010177103 0.0113224468 0.008902077
38:           physical_activity5_y 0.0009699393 0.0118993071 0.008902077
39:    reshist_state_sexism_factor 0.0009476006 0.0010241195 0.002967359
40:                  sds_p_ss_does 0.0008508860 0.0005994453 0.002967359
41:    reshist_addr1_coi_ed_hsgrad 0.0006410472 0.0056434101 0.005934718
42:   reshist_addr1_seg_diss_nww_m 0.0005565228 0.0017147795 0.002967359
43:                   sds_p_ss_shy 0.0005541699 0.0078607627 0.005934718
44:     reshist_addr1_coi_he_green 0.0005399483 0.0043969072 0.005934718
45:              crpbi_y_ss_parent 0.0005304146 0.0010203988 0.002967359
46:           ksads_ptsd_raw_765_p 0.0004870239 0.0079182947 0.005934718
47:    reshist_state_racism_factor 0.0003502741 0.0007289068 0.002967359
48:    reshist_addr1_traffic_count 0.0003421451 0.0022629202 0.002967359
49:                  kbi_p_c_bully 0.0002789736 0.0012822764 0.002967359
50:                  sds_p_ss_dims 0.0002422852 0.0005727602 0.002967359
                           Feature         Gain        Cover   Frequency
> ## Create table comparing distributions of top 20 important variables by any_util
> vars <- as.vector(unlist(importance_matrix[1:20,1]))
> imp <- data.frame(importance_matrix)
> names(imp) <- c("Variable","Gain","Cover","Frequency")
> 
> table_util_imp <- CreateTableOne(vars = vars,
+                                  strata = c("resilience"), 
+                                  includeNA = F, 
+                                  addOverall = F,
+                                  data = d_flpov)
> table_util_imp <- data.frame(print(table_util_imp, explain=F, missing=T, catDigits = 2, contDigits = 2))
                              Stratified by resilience
                               0              1              p      test
  n                               860            505                    
  reshist_addr1_seg_ice_inc_bw   0.02 (0.23)    0.11 (0.22)  <0.001     
  cbcl_scr_syn_attention_r       3.70 (3.99)    2.41 (3.11)  <0.001     
  inr                            1.01 (0.59)    1.19 (0.56)  <0.001     
  reshist_addr1_seg_ice_income  -0.07 (0.27)    0.03 (0.26)  <0.001     
  reshist_addr1_coi_se_public   21.51 (14.58)  16.52 (12.46) <0.001     
  interview_age                118.40 (7.41)  119.53 (7.74)   0.007     
  birth_weight                   6.85 (1.45)    7.12 (1.43)   0.001     
  devhx_18_p                     5.43 (7.30)    7.16 (7.73)  <0.001     
  demo_prnt_ed_v2               13.55 (2.04)   14.08 (2.14)  <0.001     
  demo_prtnr_ed_v2              13.17 (2.47)   13.78 (2.55)  <0.001     
  reshist_addr1_coi_ed_schpov   67.59 (24.25)  60.21 (25.58) <0.001     
  sai_p_perf_arts                0.38 (0.48)    0.48 (0.50)  <0.001     
  upps_y_ss_positive_urgency     8.58 (3.01)    7.96 (3.04)  <0.001     
  demo_mar_livingwith            0.52 (0.50)    0.65 (0.48)  <0.001     
  pds_p_ss_cat                   1.99 (0.92)    1.82 (0.89)   0.001     
  ksads_ptsd_raw_769_p           0.02 (0.15)    0.01 (0.08)   0.012     
  reshist_addr1_coi_se_single   45.97 (21.60)  39.63 (20.08) <0.001     
  reshist_addr1_coi_ed_math    187.98 (65.90) 209.08 (68.47) <0.001     
  reshist_addr1_adi_perc        57.86 (27.55)  49.81 (25.98) <0.001     
  reshist_addr1_coi_se_povrate  20.83 (12.93)  16.79 (11.43) <0.001     
                              Stratified by resilience
                               Missing
  n                                   
  reshist_addr1_seg_ice_inc_bw 0.0    
  cbcl_scr_syn_attention_r     0.0    
  inr                          0.0    
  reshist_addr1_seg_ice_income 0.0    
  reshist_addr1_coi_se_public  0.0    
  interview_age                0.0    
  birth_weight                 0.0    
  devhx_18_p                   0.0    
  demo_prnt_ed_v2              0.0    
  demo_prtnr_ed_v2             0.0    
  reshist_addr1_coi_ed_schpov  0.0    
  sai_p_perf_arts              0.0    
  upps_y_ss_positive_urgency   0.0    
  demo_mar_livingwith          0.0    
  pds_p_ss_cat                 0.0    
  ksads_ptsd_raw_769_p         0.0    
  reshist_addr1_coi_se_single  0.0    
  reshist_addr1_coi_ed_math    0.0    
  reshist_addr1_adi_perc       0.0    
  reshist_addr1_coi_se_povrate 0.0    
> table_util_imp <- tibble::rownames_to_column(table_util_imp, "Characteristic")[,c(1:5)]
> table_util_imp
                 Characteristic             X0             X1      p test
1                             n            860            505            
2  reshist_addr1_seg_ice_inc_bw    0.02 (0.23)    0.11 (0.22) <0.001     
3      cbcl_scr_syn_attention_r    3.70 (3.99)    2.41 (3.11) <0.001     
4                           inr    1.01 (0.59)    1.19 (0.56) <0.001     
5  reshist_addr1_seg_ice_income   -0.07 (0.27)    0.03 (0.26) <0.001     
6   reshist_addr1_coi_se_public  21.51 (14.58)  16.52 (12.46) <0.001     
7                 interview_age  118.40 (7.41)  119.53 (7.74)  0.007     
8                  birth_weight    6.85 (1.45)    7.12 (1.43)  0.001     
9                    devhx_18_p    5.43 (7.30)    7.16 (7.73) <0.001     
10              demo_prnt_ed_v2   13.55 (2.04)   14.08 (2.14) <0.001     
11             demo_prtnr_ed_v2   13.17 (2.47)   13.78 (2.55) <0.001     
12  reshist_addr1_coi_ed_schpov  67.59 (24.25)  60.21 (25.58) <0.001     
13              sai_p_perf_arts    0.38 (0.48)    0.48 (0.50) <0.001     
14   upps_y_ss_positive_urgency    8.58 (3.01)    7.96 (3.04) <0.001     
15          demo_mar_livingwith    0.52 (0.50)    0.65 (0.48) <0.001     
16                 pds_p_ss_cat    1.99 (0.92)    1.82 (0.89)  0.001     
17         ksads_ptsd_raw_769_p    0.02 (0.15)    0.01 (0.08)  0.012     
18  reshist_addr1_coi_se_single  45.97 (21.60)  39.63 (20.08) <0.001     
19    reshist_addr1_coi_ed_math 187.98 (65.90) 209.08 (68.47) <0.001     
20       reshist_addr1_adi_perc  57.86 (27.55)  49.81 (25.98) <0.001     
21 reshist_addr1_coi_se_povrate  20.83 (12.93)  16.79 (11.43) <0.001     
> 
> names(table_util_imp) <- c("Variable", "Poverty_Low_Cog", "Poverty_High_Cog","p_value","prop_missing")
> 
> table_util_imp_label <- merge(x=table_util_imp, y=dict, by="Variable",all.x=T) %>%
+   dplyr::select(Label,Variable,Poverty_Low_Cog,Poverty_High_Cog,p_value,prop_missing,Order,Order2)
> 
> table_util_imp_label_gain <- merge(x=table_util_imp_label, y=imp, all.x=T, by="Variable")
> table_util_imp_label_gain
                       Variable
1                  birth_weight
2      cbcl_scr_syn_attention_r
3           demo_mar_livingwith
4               demo_prnt_ed_v2
5              demo_prtnr_ed_v2
6                    devhx_18_p
7                           inr
8                 interview_age
9          ksads_ptsd_raw_769_p
10                            n
11                 pds_p_ss_cat
12       reshist_addr1_adi_perc
13    reshist_addr1_coi_ed_math
14  reshist_addr1_coi_ed_schpov
15 reshist_addr1_coi_se_povrate
16  reshist_addr1_coi_se_public
17  reshist_addr1_coi_se_single
18 reshist_addr1_seg_ice_inc_bw
19 reshist_addr1_seg_ice_income
20              sai_p_perf_arts
21   upps_y_ss_positive_urgency
                                                                                                                                                                                                                                                                                                                    Label
1                                                                                                                                                                                                                                                                     Developmental history quesitonnaire: birth weight: 
2                                                                                                                                                                                                                  Child dimensional psychopathology - CBCL -  parent-reported: Attention CBCL Syndrome Scale (raw score)
3                                                                                                                                                                                                                                                                                 Parent married or living with a partner
4                                                                                                                                                                                        Parental ed - primary: What is the highest grade or level of school you have completed or the highest degree you have received? 
5                                                                                                                                              Parental ed - secondary: What is the highest grade or level of school your partner completed or highest degree they received? (imputed with parent's education if missing)
6                                                                                                                                                                                                                                                      Developmental history questionnaire: nuumber of months breastfed: 
7                                                                                                                                                                                                                                                                                                                     INR
8                                                                                                                                                                                                                                                                                                                    <NA>
9                                                                                                                                                          Adversity - Sexual abuse - broad psychopathology, KSADS - post-traumatic stress disorder (indiv. Questions): A peer forced your child to do something sexually
10                                                                                                                                                                                                                                                                                                                      n
11                                                                                                                                                                                                                                                                                                 Pubertal development: 
12                                                                                                                                                                                                                   Neightbohood quality: Area Deprivation Index (national percentiles, higher means higher deprivation)
13                                                                                                                                                                                              Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Education Domain: Third grade math proficiency
14                                                                                                                                                                                                            Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Education Domain: School poverty
15                                                                                                                                                                                                    Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Social and Economic Domain: Poverty rate
16                                                                                                                                                                                          Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Social and Economic Domain: Public assistance rate
17                                                                                                                                                                                        Neightbohood quality: Child opportunity index (COI) 2.0 - primary address: Social and Economic Domain: Single-headed households
18 Neighborhood: residential segregation - Index of Concentrations at the Extremes: Residential history derived- Index of Concentration at the Extremes(Income+ BW), (non-Hispanic white Households income >= $100k) - (non-Hispanic Black Households income < $25k)/total population, ACS2014-2018; census tract (addr1)
19                                          Neighborhood: residential segregation - Index of Concentrations at the Extremes: Residential history derived- Index of Concentration at the Extremes (income), (Households income >= $100k) - (Households income < $25k)/total population, ACS2014-2018; census tract (addr1)
20                                                                                                                                                                                                                                                            Physical activity / hobbies: Ever performing arts (0,23,25)
21                                                                                                            Temperament/Personality: UPPS-P (Urgency, Premeditation, Perseverance, Sensation Seeking, Positive Urgency, Impulsive behavior scale): Positive Urgency: tendency to act impulsively due to positive affect
   Poverty_Low_Cog Poverty_High_Cog p_value prop_missing Order Order2
1      6.85 (1.45)      7.12 (1.43)   0.001                  2      2
2      3.70 (3.99)      2.41 (3.11)  <0.001                  3     52
3      0.52 (0.50)      0.65 (0.48)  <0.001                  1      3
4     13.55 (2.04)     14.08 (2.14)  <0.001                  1      1
5     13.17 (2.47)     13.78 (2.55)  <0.001                  1      2
6      5.43 (7.30)      7.16 (7.73)  <0.001                  2     16
7      1.01 (0.59)      1.19 (0.56)  <0.001                  0      1
8    118.40 (7.41)    119.53 (7.74)   0.007                 NA     NA
9      0.02 (0.15)      0.01 (0.08)   0.012                  3     16
10             860              505                          0      0
11     1.99 (0.92)      1.82 (0.89)   0.001                  2      1
12   57.86 (27.55)    49.81 (25.98)  <0.001                  7      1
13  187.98 (65.90)   209.08 (68.47)  <0.001                  7     14
14   67.59 (24.25)    60.21 (25.58)  <0.001                  7     12
15   20.83 (12.93)    16.79 (11.43)  <0.001                  7     31
16   21.51 (14.58)    16.52 (12.46)  <0.001                  7     32
17   45.97 (21.60)    39.63 (20.08)  <0.001                  7     33
18     0.02 (0.23)      0.11 (0.22)  <0.001                  7     52
19    -0.07 (0.27)      0.03 (0.26)  <0.001                  7     51
20     0.38 (0.48)      0.48 (0.50)  <0.001                  2     23
21     8.58 (3.01)      7.96 (3.04)  <0.001                  3     59
         Gain       Cover   Frequency
1  0.02876329 0.077193980 0.071216617
2  0.24807800 0.153417734 0.151335312
3  0.01511524 0.017314824 0.014836795
4  0.02486295 0.037418076 0.035608309
5  0.02125087 0.011568628 0.011869436
6  0.02782481 0.026793323 0.023738872
7  0.07118586 0.034043023 0.029673591
8  0.03060453 0.090345767 0.077151335
9  0.01422813 0.051170188 0.041543027
10         NA          NA          NA
11 0.01465229 0.045496747 0.041543027
12 0.01231618 0.007751173 0.011869436
13 0.01278952 0.015037233 0.017804154
14 0.01700989 0.008219595 0.008902077
15 0.01213361 0.005569091 0.008902077
16 0.03659834 0.021892910 0.026706231
17 0.01337243 0.006210000 0.005934718
18 0.24916294 0.056467370 0.053412463
19 0.05337222 0.008784348 0.005934718
20 0.01636577 0.027861790 0.029673591
21 0.01543958 0.044121418 0.035608309
> 
> write.csv(table_util_imp_label_gain,"/Users/Kat/Library/CloudStorage/OneDrive-HarvardUniversity/abcd_study_with_kat/results/INR_tert_fluid_cvSL_comp_table_util_imp_label_gain.csv")
> 
> #-- Run a logistic regression with the top 20 important predictors selected by xgboost
> glm_cvxgboost = glm(data=d_flpov, formula(paste("resilience ~ ",paste(table_util_imp$Variable[2:21], collapse ="+"), collapse = " ")), family="binomial")
> 
> summary(glm_cvxgboost)

Call:
glm(formula = formula(paste("resilience ~ ", paste(table_util_imp$Variable[2:21], 
    collapse = "+"), collapse = " ")), family = "binomial", data = d_flpov)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.6960  -0.9416  -0.6761   1.1603   2.5172  

Coefficients:
                              Estimate Std. Error z value Pr(>|z|)    
(Intercept)                  -5.817148   1.323003  -4.397 1.10e-05 ***
reshist_addr1_seg_ice_inc_bw  1.250739   0.676019   1.850  0.06429 .  
cbcl_scr_syn_attention_r     -0.091720   0.018122  -5.061 4.16e-07 ***
inr                           0.155347   0.117479   1.322  0.18606    
reshist_addr1_seg_ice_income -0.200683   0.636252  -0.315  0.75245    
reshist_addr1_coi_se_public  -0.012778   0.008945  -1.428  0.15315    
interview_age                 0.026518   0.008100   3.274  0.00106 ** 
birth_weight                  0.104081   0.042087   2.473  0.01340 *  
devhx_18_p                    0.007111   0.008392   0.847  0.39682    
demo_prnt_ed_v2               0.048813   0.035049   1.393  0.16370    
demo_prtnr_ed_v2              0.017619   0.029303   0.601  0.54767    
reshist_addr1_coi_ed_schpov   0.003110   0.004028   0.772  0.44004    
sai_p_perf_arts               0.283905   0.125547   2.261  0.02374 *  
upps_y_ss_positive_urgency   -0.030511   0.020181  -1.512  0.13057    
demo_mar_livingwith           0.186704   0.130201   1.434  0.15158    
pds_p_ss_cat                 -0.177467   0.070970  -2.501  0.01240 *  
ksads_ptsd_raw_769_p         -1.431699   0.636054  -2.251  0.02439 *  
reshist_addr1_coi_se_single   0.009660   0.005331   1.812  0.06998 .  
reshist_addr1_coi_ed_math     0.002248   0.001341   1.676  0.09371 .  
reshist_addr1_adi_perc        0.001164   0.003686   0.316  0.75209    
reshist_addr1_coi_se_povrate -0.001835   0.010244  -0.179  0.85782    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1798.9  on 1364  degrees of freedom
Residual deviance: 1650.8  on 1344  degrees of freedom
AIC: 1692.8

Number of Fisher Scoring iterations: 4

> 
> pred <- predict(glm_cvxgboost, newdata=d_flpov, type="response")
> roc_test <- roc(labels, pred, algorithm = 2) 
Setting levels: control = 0, case = 1
Setting direction: controls < cases
> roc_test$auc
Area under the curve: 0.6927
> 
> 
> # #-------------------------------------#
> # #-- SuperLearner in 1x imputed data --#
> # 
> # d <- complete(d_imp)
> # 
> # d_pov_highcrcog <- d %>% filter(pov3_highflcog==1) %>% 
> #   mutate(profile="pov3_highflcog",
> #          resilience=1)
> # d_pov_lowcrcog <- d %>% filter(pov3_lowflcog==1) %>% 
> #   mutate(profile="pov3_lowflcog",
> #          resilience=0)
> # 
> # d_flpov <- rbind(d_pov_highcrcog,d_pov_lowcrcog)
> # 
> # set.seed(123)
> # #-- Cross-validated SL
> # options(mc.cores = 4)
> # getOption("mc.cores")
> # 
> # labels <- d_flpov$resilience
> # 
> # X <- d_flpov[,c(5,31:199)]
> # 
> # set.seed(123)
> # sl_fit <- CV.SuperLearner(Y = labels, X = X, family = binomial(),
> #                           parallel = "multicore",
> #                           id = d_flpov$rel_family_id,
> #                           SL.library = SL.library)
> # sl_fit$coef
> # 
> # pred = sl_fit$SL.predict
> # pred_rocr = ROCR::prediction(pred, labels)
> # auc = ROCR::performance(pred_rocr, measure = "auc", x.measure = "cutoff")@y.values[[1]]
> # auc
> # 
> # 
> # new_ts <- as.matrix(X)
> # dim(new_ts)
> # length(pred)
> # 
> # xgb_util <- xgboost(data = new_ts, label = pred, nrounds = 200, verbose=FALSE,params=params)
> # importance_matrix <- xgb.importance(model = xgb_util)
> # importance_matrix
> # ## Create table comparing distributions of top 20 important variables by any_util
> # vars <- as.vector(unlist(importance_matrix[1:20,1]))
> # imp <- data.frame(importance_matrix)
> # names(imp) <- c("Variable","Gain","Cover","Frequency")
> # 
> # table_util_imp <- CreateTableOne(vars = vars,
> #                                  strata = c("resilience"), 
> #                                  includeNA = F, 
> #                                  addOverall = F,
> #                                  data = d_flpov)
> # table_util_imp <- data.frame(print(table_util_imp, explain=F, missing=T, catDigits = 2, contDigits = 2))
> # table_util_imp <- tibble::rownames_to_column(table_util_imp, "Characteristic")[,c(1:5)]
> # table_util_imp
> # 
> # names(table_util_imp) <- c("Variable", "Poverty_Low_Cog", "Poverty_High_Cog","p_value","prop_missing")
> # 
> # table_util_imp_label <- merge(x=table_util_imp, y=dict, by="Variable",all.x=T) %>%
> #   dplyr::select(Label,Variable,Poverty_Low_Cog,Poverty_High_Cog,p_value,prop_missing,Order,Order2)
> # 
> # table_util_imp_label_gain <- merge(x=table_util_imp_label, y=imp, all.x=T, by="Variable")
> # table_util_imp_label_gain
> # 
> # write.csv(table_util_imp_label_gain,"/Users/Kat/Library/CloudStorage/OneDrive-HarvardUniversity/abcd_study_with_kat/results/INR_tert_fluid_cvSL_imputed1x_table_util_imp_label_gain.csv")
> # 
> # #-- Run a logistic regression with the top 20 important predictors selected by xgboost
> # glm_cvxgboost = glm(data=d_flpov, formula(paste("resilience ~ ",paste(table_util_imp$Variable[2:21], collapse ="+"), collapse = " ")), family="binomial")
> # 
> # summary(glm_cvxgboost)
> # 
> # pred <- predict(glm_cvxgboost, newdata=d_flpov, type="response")
> # roc_test <- roc(labels, pred, algorithm = 2) 
> # roc_test$auc
> 
> 
> #-----------#
> #-- LASSO --#
> 
> 
> #---------------------------------------#
> #-- cross-validated in complete cases --#
> 
> d_pov_highcrcog <- dat_all_inr_complete %>% filter(pov3_highflcog==1) %>% 
+   mutate(profile="pov3_highflcog",
+          resilience=1)
> d_pov_lowcrcog <- dat_all_inr_complete %>% filter(pov3_lowflcog==1) %>% 
+   mutate(profile="pov3_lowflcog",
+          resilience=0)
> 
> d_flpov <- rbind(d_pov_highcrcog,d_pov_lowcrcog)
> 
> 
> # Prepare data set 
> x <- as.matrix(d_flpov[,c(2,28:190)])
> y <- factor(d_flpov$resilience)
> 
> 
> # Run cross-validation
> set.seed(123)
> mod_cv <- cv.glmnet(x=x, y=y, family='binomial')
> 
> mod_cv$lambda.1se
[1] 0.03837095
> 
> coefs <- tibble::rownames_to_column(data.frame(as.matrix(coef(mod_cv, mod_cv$lambda.1se))), "name") %>%
+   filter(s1 != 0 & name != "(Intercept)")
> coefs
                          name            s1
1                          inr  0.1032441792
2    reshist_addr1_coi_ed_math  0.0001910825
3  reshist_addr1_coi_se_public -0.0035692249
4 reshist_addr1_seg_ice_inc_bw  0.6081360817
5          demo_mar_livingwith  0.0124316655
6              demo_prnt_ed_v2  0.0110212429
7     cbcl_scr_syn_attention_r -0.0477041746
> 
> lasso_pred <- predict(mod_cv,s=mod_cv$lambda.1se,newx=x,type="response")
> summary(lasso_pred)
       s1        
 Min.   :0.1546  
 1st Qu.:0.3262  
 Median :0.3721  
 Mean   :0.3700  
 3rd Qu.:0.4175  
 Max.   :0.5291  
> hist(lasso_pred)
> roc_test <- roc(y, lasso_pred, algorithm = 2) 
Setting levels: control = 0, case = 1
Setting direction: controls < cases
Warning message:
In roc.default(y, lasso_pred, algorithm = 2) :
  Deprecated use a matrix as predictor. Unexpected results may be produced, please pass a numeric vector.
> roc_test$auc
Area under the curve: 0.6606
> 
> glm_cvxgboost = glm(data=d_flpov, formula(paste("resilience ~ ",paste(coefs$name, collapse ="+"), collapse = " ")), family="binomial")
> 
> obj<-summary(glm_cvxgboost)$coefficients
> write.csv(obj,"/Users/Kat/Library/CloudStorage/OneDrive-HarvardUniversity/abcd_study_with_kat/results/INR_tert_fluid_cvLASSO_comp_coef.csv")
> 
> 
> pred <- predict(glm_cvxgboost, newdata=d_flpov, type="response")
> roc_test <- roc(y, pred, algorithm = 2) 
Setting levels: control = 0, case = 1
Setting direction: controls < cases
> roc_test$auc
Area under the curve: 0.6659
> 
> 
> 
> #----------------------------------------#
> #-- cross-validated in 1x imputed data --#
> 
> d <- complete(d_imp)
> 
> d_pov_highflcog <- d %>% filter(pov3_highflcog==1) %>% 
+   mutate(profile="pov3_highflcog",
+          resilience=1)
> d_pov_lowflcog <- d %>% filter(pov3_lowflcog==1) %>% 
+   mutate(profile="pov3_lowflcog",
+          resilience=0)
> 
> d_flpov <- rbind(d_pov_highflcog,d_pov_lowflcog)
> 
> 
> # Prepare data set 
> x <- as.matrix(d_flpov[,c(2,28:190)])
> y <- factor(d_flpov$resilience)
> 
> 
> # Run cross-validation
> set.seed(123)
> mod_cv <- cv.glmnet(x=x, y=y, family='binomial')
> 
> mod_cv$lambda.1se
[1] 0.02098124
> 
> 
> coefs <- tibble::rownames_to_column(data.frame(as.matrix(coef(mod_cv, mod_cv$lambda.1se))), "name") %>%
+   filter(s1 != 0 & name != "(Intercept)")
> coefs
                           name           s1
1                           inr  0.120726833
2                 interview_age  0.004879421
3  reshist_addr1_coi_he_vacancy -0.007998154
4  reshist_addr1_coi_se_povrate -0.003381628
5   reshist_addr1_coi_se_public -0.002869698
6  reshist_addr1_seg_ice_income  0.038226046
7  reshist_addr1_seg_ice_inc_bw  0.311703372
8               demo_prnt_ed_v2  0.036752912
9              demo_prtnr_ed_v2  0.005844769
10                 pds_p_ss_cat -0.012673499
11                 birth_weight  0.047776494
12                   devhx_18_p  0.004633058
13         physical_activity1_y  0.007141342
14              sai_p_perf_arts  0.075690297
15           bis_y_ss_bas_drive -0.006711842
16   upps_y_ss_positive_urgency -0.023168466
17     cbcl_scr_syn_attention_r -0.042722313
18           parent_subst_rules -0.021283791
> 
> lasso_pred <- predict(mod_cv,s=mod_cv$lambda.1se,newx=x,type="response")
> summary(lasso_pred)
       s1        
 Min.   :0.1059  
 1st Qu.:0.2830  
 Median :0.3432  
 Mean   :0.3433  
 3rd Qu.:0.4008  
 Max.   :0.5863  
> hist(lasso_pred)
> roc_test <- roc(y, lasso_pred, algorithm = 2) 
Setting levels: control = 0, case = 1
Setting direction: controls < cases
Warning message:
In roc.default(y, lasso_pred, algorithm = 2) :
  Deprecated use a matrix as predictor. Unexpected results may be produced, please pass a numeric vector.
> roc_test$auc
Area under the curve: 0.6713
> 
> glm_cvxgboost = glm(data=d_flpov, formula(paste("resilience ~ ",paste(coefs$name, collapse ="+"), collapse = " ")), family="binomial")
> 
> obj<-summary(glm_cvxgboost)$coefficients
> write.csv(obj,"/Users/Kat/Library/CloudStorage/OneDrive-HarvardUniversity/abcd_study_with_kat/results/INR_tert_fluid_cvLASSO_1ximp_coef.csv")
> 
> 
> pred <- predict(glm_cvxgboost, newdata=d_flpov, type="response")
> roc_test <- roc(y, pred, algorithm = 2) 
Setting levels: control = 0, case = 1
Setting direction: controls < cases
> roc_test$auc
Area under the curve: 0.6781
> 
> proc.time()
    user   system  elapsed 
5383.210   50.857 2579.505 
